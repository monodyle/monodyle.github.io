<!DOCTYPE html><html lang="en"><head><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#24292e"/><meta name="apple-mobile-web-app-title" content="The Monody&#x27;s Space"/><meta name="application-name" content="The Monody&#x27;s Space"/><meta name="msapplication-TileColor" content="#1366E9"/><meta name="theme-color" content="#ffffff"/><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Mấy cái trò Database Hacking</title><meta name="title" content="Mấy cái trò Database Hacking"/><meta name="description" content="Hello, just a simple guy."/><meta name="image" content="https://monodyle.github.io/assets/blog/sql-database-hacking/featured.jpg"/><meta property="og:url" content="https://monodyle.github.io/blog/sql-database-hacking"/><meta property="og:type" content="website"/><meta property="og:title" content="Mấy cái trò Database Hacking"/><meta property="og:description" content="Hello, just a simple guy."/><meta property="og:image" content="https://monodyle.github.io/assets/blog/sql-database-hacking/featured.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="Monody Le"/><meta name="twitter:title" content="Mấy cái trò Database Hacking"/><meta name="twitter:description" content="Hello, just a simple guy."/><meta name="twitter:image" content="https://monodyle.github.io/assets/blog/sql-database-hacking/featured.jpg"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/c4614ce58cf99c21c738.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c4614ce58cf99c21c738.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b1003c7fd9af2bec9916.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b1003c7fd9af2bec9916.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-cf627c1b502115102538.js" defer=""></script><script src="/_next/static/chunks/framework-64eb7138163e04c228e4.js" defer=""></script><script src="/_next/static/chunks/main-021fc08f00c92a589d4e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-73554b86524b8d57d1e7.js" defer=""></script><script src="/_next/static/chunks/670-e913ad2df44a9360cf4c.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-da4a89074689a68e09d0.js" defer=""></script><script src="/_next/static/EoFBNuKZQIZTtRXAUTpDc/_buildManifest.js" defer=""></script><script src="/_next/static/EoFBNuKZQIZTtRXAUTpDc/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="flex flex-col items-center justify-between min-h-screen"><div class="container flex flex-col px-16 py-20 mx-auto"><nav class="flex items-center justify-between leading-6"><div class="flex items-center"><a class="text-base font-bold leading-6 rainbown cursor-pointer" href="/">home.</a><div class="px-4 text-dark-muted">/</div><span class="text-base font-bold leading-6">writing.<!-- --> <!-- -->📝</span></div><div class="flex items-center"><div class="w-12"></div><a class="text-base font-bold leading-6 rainbown cursor-none" href="/hi">say hi.</a><div class="cursor_cursor__1ID5l cursor_hide__17TGI " style="left:0;top:0"><div class="cursor_icon__2mcpm"><div class="cursor_wave__1Tlmd">👋</div></div></div><div class="w-12"></div><a class="text-base font-bold leading-6 rainbown cursor-none" href="/work">working.</a><div class="cursor_cursor__1ID5l cursor_hide__17TGI " style="left:0;top:0"><div class="cursor_icon__2mcpm">💻</div></div></div></nav><div class="h-16"></div><div class="flex-auto flex-shrink-0"><article class="post_article__2w3XN"><div class="mb-6 font-bold"><a class="rainbown" href="/blog">&lt; Back</a></div><div class="post_hero__3BSnJ"><img src="/assets/blog/sql-database-hacking/featured.jpg" alt="Mấy cái trò Database Hacking" title="Mấy cái trò Database Hacking"/></div><div class="flex items-center justify-between mb-2"><span class="post_time__ih63X">Mar 15, 2020</span><div class="flex"><span class="post_tag__28ZFZ">web</span><span class="post_tag__28ZFZ">database</span><span class="post_tag__28ZFZ">hacking</span><span class="post_tag__28ZFZ">security</span></div></div><h2 class="post_title__3g4nB">Mấy cái trò Database Hacking</h2><div id="content" class="post_content__1tL7U post_markdown__38t3u"><p>Hôm nọ mình vừa đọc được một bài write-up của một bạn white-hat sau khi báo cáo lại lỗ hổng SQL Injection trên trang web của Đại học Harvard, tự dưng thấy kỹ năng về bảo mật của mình bao lâu nay... kém ghê.</p>
<p>Bản thân là sinh viên chuyên ngành <strong>Hệ Thống Thông Tin</strong>, tức là chuyên ngồi đấu vật với mấy cái cơ sở dữ liệu mà lại rất hay quên đi những cái quan trọng như thế này... Cảm thấy xấu hổ, thế là mình phải mò lại những gì mình đã học, nhưng không dùng tới lại quên mất, rồi viết thành một blog để coi như vừa học lại, vừa chia sẻ kiến thức cho mọi người <img src="/assets/emoji/smug.png" emoji /> <del>Mình thật tuyệt</del></p>
<h2 id="thằng-chó-mày-hack-web-bố-mày">Thằng chó, mày hack web bố mày...</h2>
<p>Hè vừa rồi mình có trò chuyện với một ông anh trong nghề, ổng tâm sự về chuyện bị thằng nào thả bot nó clean mẹ cái database, để lại đúng một dòng duy nhất:</p>
<blockquote>
<p>Gửi bố mày vài Bitcoin đê, bố mày trả lại dữ liệu cho... <img src="/assets/emoji/look_down.png" emoji /></p>
</blockquote>
<p>Và kèm theo đó là địa chỉ ví bitcoin của hắn <img src="/assets/emoji/surrender.png" emoji /> Tính ông anh mình được cái thật thà, nhà cũng không có gì ngoài điều kiện, thế là gửi cho nó vài bitcoin coi như tiền ăn sáng, hôm sau thấy nó restore lại dữ liệu thật <img src="/assets/emoji/mokas.png" emoji /></p>
<p>Nhưng mà tức quá, ai đời làm lập trình có sản phẩm đang chạy phà phà lại có thằng choá nào hack, nghĩ có cay không cơ chứ? <img src="/assets/emoji/yikes.png" emoji /></p>
<p>Mình không rõ là cái database đó bị hack như thế nào, nhưng khá chắc chắn phần lớn là bởi vì code chưa đủ bảo mật và có nhiều lỗ hổng. Các hacker sẽ viết một con bot chuyên đi dạo trên mạng để attack vào những case bảo mật thường dễ bị hack nhất.</p>
<p>Vì vậy bài viết này mình sẽ giới thiệu cho các bạn một loại lỗ hổng <strong>cơ bản</strong> nhưng cực kỳ nguy hiểm, giải thích cơ chế và hướng dẫn cách phòng chống. Và xin giới thiệu cái trò gọi là <strong>SQL Injection</strong>.</p>
<p><strong>Lưu ý:</strong></p>
<p>Bài viết này nhằm mục đích giao lưu kỹ năng bảo mật lập trình, không cổ suý các bạn đi phá làng phá xóm. Hãy tỉnh táo <img src="/assets/emoji/smug.png" emoji /></p>
<h2 id="nhập-môn-hack-cơ-sở-dữ-liệu-sql">Nhập môn hack Cơ sở dữ liệu SQL</h2>
<p>Trong nhiều loại tấn công lỗ hổng nhằm vào website, tấn công <strong>SQL Injection</strong> là một trong những loại nguy hiểm và phổ biến nhất. Nó đã từng gây ra nhiều thiệt hại đáng kể cho nhiều doanh nghiệp và tổ chức trong rất nhiều năm, và đương nhiên sẽ còn tiếp diễn trong tương lai.</p>
<p></p>
<p>Theo <a href="https://vi.wikipedia.org/wiki/SQL_injection">Wikipedia</a> <img src="/assets/emoji/popcorn.png" emoji />:</p>
<blockquote>
<p><strong>SQL injection</strong> là một kỹ thuật cho phép những kẻ tấn công lợi dụng lỗ hổng của việc kiểm tra dữ liệu đầu vào trong các ứng dụng web và các thông báo lỗi của hệ quản trị cơ sở dữ liệu trả về để <em>inject</em> (<em>tiêm vào</em>) và thi hành các câu lệnh SQL bất hợp pháp.</p>
</blockquote>
<p>Ờ thì khái niệm như vậy đấy, hiểu một cách đơn giản tức là loại tấn công này nhằm vào các <strong>input</strong> có <strong>tương tác trực tiếp</strong> với <strong>database</strong> ở <strong>back-end</strong> (ví dụ như các input email, password ở form login). Thông thường, attacker sẽ tấn công để ăn cắp dữ liệu, loại này về cơ bản là hiền nhất, sau đó tới xáo trộn dữ liệu để cản trở sự hoạt động của website, và trường hợp xấu nhất, là quyền truy cập quản trị vào máy chủ database bị chiếm. <img src="/assets/emoji/moka.png" emoji /></p>
<p>Trong lịch sử, đã có rất nhiều đợt tấn công SQL Injection nhằm mục đích:</p>
<ul>
<li>Trích xuất thông tin nhạy cảm, ví dụ như về an sinh xã hội, hay thông tin thẻ tín dụng</li>
<li>Trích xuất thông tin người dùng đã được đăng ký trên các website, ở Việt Nam cũng không ít trường hợp</li>
<li>Xoá luôn cái database, có rất nhiều trang web không sử dụng backup dữ liệu, và khi bị xoá thì coi như cả hệ thống tê liệt, ví dụ của ông anh bên trên là ví dụ gần gũi nhất</li>
<li>Tiêm mã độc thực thi vào trang web khi người dùng truy cập</li>
</ul>
<p><strong>Nhắc lại một lần nữa:</strong> Tấn công về SQL Injection cực kỳ phổ biến. Các công ty lớn như <strong>Yahoo</strong> hay <strong>Sony</strong> đã từng là nhạn nhân của trò chơi này. Các nhóm hacker còn viết hẳn các script bot để tự đi tấn công dạo trên internet, vì vậy hãy luôn cẩn thận với sản phẩm của bạn.</p>
<h3 id="cơ-chế-khai-thác-và-tấn-công">Cơ chế khai thác và tấn công</h3>
<p>SQL Injection tấn công bằng cách gửi một mã lệnh SQL độc đến back-end của máy chủ cơ sở đữ liệu, thông qua các request của người dùng mà website cho phép. Bất kỳ input nào cũng có thể được sử dụng để gửi mã độc, tức là bao gồm cả: các thẻ <code>&#x3C;input></code> nhập liệu, query strings, cookies và file upload.</p>
<p>Mình sẽ có một ví dụ như sau: Giả sử đây là trang đăng nhập vào ngân hàng <strong>PankHub</strong>, với form đăng nhập gồm 2 fields là <code>email</code> và <code>password</code>:</p>
<p>Bây giờ mình sẽ thử đăng nhập tài khoản của người dùng tên là <strong>Phát</strong> (jk, don't panic) với <em>email</em> là: <code>phat.nhagiau@pankhub.com</code> và <em>password</em> là <code>password</code></p>
<p>Ừ thì đương nhiên là không đăng nhập được rồi <img src="/assets/emoji/okay.png" emoji /> Đây là trường hợp giả sử mình là một attacker, và mình tình cờ địa được email của người dùng này sau khi đi ngang qua lúc nó đang đăng nhập vào ngân hàng ở tiệm net <img src="/assets/emoji/smug.png" emoji /> Victim của mình là một thằng đại gia nhà giàu, tiền không những được quy ra bằng vàng để trong két mà còn có cả một đống trong nhà băng. Xác định được mục tiêu thì trích xuất thông tin mục tiêu là điều cần thiết. Vì vậy mình chỉ thử đăng nhập cho vui thôi, đương nhiên làm gì có thằng <del>ngu</del> nào đặt mật khẩu là <code>password</code> cơ chứ (jk)</p>
<p>Bây giờ hãy nhìn vấn đề từ phía server log nhé, chúng ta sẽ có 1 cái logging như sau:</p>
<pre><code>Rendering login page.
Checking supplied authentication details for phat.nhagiau@pankhub.com.
Finding user in database.
No such user, report this to the user (invalid credentials?).
Rendering login page.
</code></pre>
<p>Sau đó, mình tiếp tục truy thử login vào tài khoản của victim, nhưng lần này password mình sẽ thêm một <em>dấu nháy đơn</em> <code>'</code>, kết quả có được là:</p>
<p>Thấy sự khác biệt rồi phải không? Thông thường, với những trường hợp sai thông tin đăng nhập sẽ luôn cho ra một message lỗi (trang nào nó random message thì bó tay), vì vậy có gì đó không đúng xảy ra rồi, có thể nguyên do là bởi dấu nháy đơn chăng?</p>
<p>Server log:</p>
<pre><code>...

Rendering login page.
Checking supplied authentication details for phat.nhagiau@pankhub.com.
Finding user in database.
An error occurred: PG::SyntaxError: ERROR: unterminated quoted string at or near "'password'' limit 1" LINE 1: ...ers where email = 'phat.nhagiau@pankhub.com' and password = 'password'... ^ : select * from users where email = 'phat.nhagiau@pankhub.com' and password = 'password'' limit 1.
Unable to login this user due to unexpected error.
Rendering login page.
</code></pre>
<p>Nhìn thấy ở log hiển thị SQL syntax error chứ? Điều này chứng tỏ dấu nháy đơn chính là nguyên nhân gây ra lỗi. Thử ghép vào câu lệnh SQL được chạy trên server thì nó sẽ trông như thế này:</p>
<pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #D73A49">SELECT</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">FROM</span><span style="color: #24292E"> users</span></span>
<span class="line"><span style="color: #24292E"> </span><span style="color: #D73A49">WHERE</span><span style="color: #24292E"> email </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">'phat.nhagiau@pankhub.com'</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">AND</span><span style="color: #24292E"> pass  </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">'password'' LIMIT 1</span></span>
<span class="line"></span></code></pre>
<p>Dư 1 dấu nháy đơn, câu lệnh này chạy trong SQL chắc chắn sẽ lỗi. Và đây chính là thứ gọi là <strong>SQL Injection</strong>.</p>
<p>Sau khi xác định được lỗ hổng, mình sẽ thử đăng nhập lại với password là <strong><code>' OR 1=1--</code></strong>. Câu lệnh SQL lúc này được thực thi trên server sẽ là:</p>
<pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #D73A49">SELECT</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">FROM</span><span style="color: #24292E"> users</span></span>
<span class="line"><span style="color: #24292E"> </span><span style="color: #D73A49">WHERE</span><span style="color: #24292E"> email </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">'phat.nhagiau@pankhub.com'</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">AND</span><span style="color: #24292E"> pass  </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">''</span><span style="color: #24292E"> </span><span style="color: #D73A49">OR</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #D73A49">=</span><span style="color: #005CC5">1</span><span style="color: #24292E"> </span><span style="color: #6A737D">--' LIMIT 1</span></span>
<span class="line"></span></code></pre>
<p>Server log:</p>
<pre><code>Rendering login page.
Checking supplied authentication details for phat.nhagiau@pankhub.com.
Finding user in database.
Authentication details confirmed, establishing session for this user.
</code></pre>
<p>Xong, tài khoản của bạn nằm trong tay tôi <img src="/assets/emoji/ok.png" emoji /></p>
<p>Cơ chế hoạt động đơn giản nhất của <strong>SQL Injection</strong> là như vậy đọ. Thực thi nó không hề khó, nhưng để nhận ra được trang nào có lỗ hổng thì lại khá khó, vì không phải lúc nào khai thác lỗ hổng SQL Injection nó cũng y chang như vậy.</p>
<h3 id="nhưng-tại-sao-có-lỗ-hổng-này">Nhưng tại sao có lỗ hổng này?</h3>
<p>Lý do lớn nhất là các bạn chưa thể tiếp cận toàn bộ các case trong quá trình code. Bạn không bao giờ lường trước được người dùng sẽ làm cái <del>đéo</del> gì trên sản phẩm của mình. <img src="/assets/emoji/sad.png" emoji /> Chính vì vậy thường các case không bao giờ được nghĩ tới này lại vô tình tạo ra lỗ hổng cho attacker khai thác.</p>
<p>Khi viết các câu lệnh SQL trong source (ở đây mình sẽ lấy <strong>PHP</strong> làm ví dụ), đa số các bạn thường viết kiểu:</p>
<pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #24292E">$query </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"</span><span style="color: #D73A49">SELECT</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #D73A49">FROM</span><span style="color: #24292E"> USERS</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">WHERE</span><span style="color: #24292E"> email </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">'"</span><span style="color: #24292E"> </span><span style="color: #D73A49">.</span><span style="color: #24292E"> $_POST[</span><span style="color: #032F62">'email'</span><span style="color: #24292E">] </span><span style="color: #D73A49">.</span><span style="color: #24292E"> </span><span style="color: #032F62">"'</span></span>
<span class="line"><span style="color: #032F62">  AND password = '"</span><span style="color: #24292E"> </span><span style="color: #D73A49">.</span><span style="color: #24292E"> $_POST[</span><span style="color: #032F62">'password'</span><span style="color: #24292E">] </span><span style="color: #D73A49">.</span><span style="color: #24292E"> </span><span style="color: #032F62">"'</span></span>
<span class="line"><span style="color: #032F62">  LIMIT 1;"</span></span>
<span class="line"><span style="color: #24292E">$result </span><span style="color: #D73A49">=</span><span style="color: #24292E"> $connection</span><span style="color: #D73A49">-></span><span style="color: #6F42C1">query</span><span style="color: #24292E">($sql);</span></span>
<span class="line"></span></code></pre>
<p>Khi người dùng gửi request đăng nhập có thông tin, thì câu query trên sẽ tương đương với:</p>
<pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #D73A49">SELECT</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">FROM</span><span style="color: #24292E"> USERS</span></span>
<span class="line"><span style="color: #24292E"> </span><span style="color: #D73A49">WHERE</span><span style="color: #24292E"> email </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">'phat.nhagiau@pankhub.com'</span></span>
<span class="line"><span style="color: #24292E">   </span><span style="color: #D73A49">AND</span><span style="color: #24292E"> </span><span style="color: #D73A49">password</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">'password'</span><span style="color: #24292E"> </span><span style="color: #D73A49">LIMIT</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span></span>
<span class="line"></span></code></pre>
<p>Tức là cái gì gửi lên, thì param tương đương sẽ được thay thế bằng cái đó. Điều này vô tình tạo ra một lỗ hổng cực kỳ nguy hiểm. Nếu bạn từng học các môn liên quan tới database hoặc làm việc với database nhiều, các bạn có thể hiểu rằng chỉ với những câu lệnh SQL thôi cũng đủ để chúng làm bất cứ thứ gì liên quan tới dữ liệu.</p>
<p>Không những thế, SQL Injection còn có thể thực thi được mã HTML hoặc PHP trong nhiều trường hợp. Đó là lý do tại sao lỗ hổng này nghiêm trọng như vậy.</p>
<h3 id="chống-injection-như-thế-nào">Chống injection như thế nào?</h3>
<h4 id="truy-vấn-tham-số-parameterized-statements">Truy vấn tham số (Parameterized Statements)</h4>
<p>Đa số các ngôn ngữ lập trình hỗ trợ truy vấn SQL đều sẽ hỗ trợ chạy các câu lệnh SQL bằng cách tạo truy vấn để trích xuất các tham số khi cần thiết. Các câu lệnh nên được <em>tham số hoá</em> để đảm bảo rằng các <em>tham số</em> (tức là <em>dữ liệu đầu vào</em>) đưa vào câu lệnh SQL được xử lý một cách an toàn nhất.</p>
<p>Với ví dụ ở <a href="#nh%c6%b0ng-t%e1%ba%a1i-sao-c%c3%b3-l%e1%bb%97-h%e1%bb%95ng-n%c3%a0y">phần trên</a>, chúng ta sẽ thử đưa nó về dạng truy vấn tham số:</p>
<pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #6A737D">// Câu lệnh SQL chờ tham số</span></span>
<span class="line"><span style="color: #24292E">$sql </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"</span><span style="color: #D73A49">SELECT</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #D73A49">FROM</span><span style="color: #24292E"> USERS</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">WHERE</span><span style="color: #24292E"> email </span><span style="color: #D73A49">=</span><span style="color: #24292E"> ?</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">AND</span><span style="color: #24292E"> </span><span style="color: #D73A49">password</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> ?</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">LIMIT</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #032F62">"</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// Chuẩn bị và ràng buộc</span></span>
<span class="line"><span style="color: #24292E">$stmt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> $connection</span><span style="color: #D73A49">-></span><span style="color: #6F42C1">prepare</span><span style="color: #24292E">($sql);</span></span>
<span class="line"><span style="color: #24292E">$stmt</span><span style="color: #D73A49">-></span><span style="color: #6F42C1">bind_param</span><span style="color: #24292E">(</span><span style="color: #032F62">"ss"</span><span style="color: #24292E">, $email, $password);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// Truyền tham số và thực thi</span></span>
<span class="line"><span style="color: #24292E">$email </span><span style="color: #D73A49">=</span><span style="color: #24292E"> $_POST[</span><span style="color: #032F62">'email'</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">$password </span><span style="color: #D73A49">=</span><span style="color: #24292E"> $_POST[</span><span style="color: #032F62">'password'</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">$stmt</span><span style="color: #D73A49">-></span><span style="color: #6F42C1">execute</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// Đừng quên close connection mỗi lần thực thi xong</span></span>
<span class="line"><span style="color: #24292E">$stmt</span><span style="color: #D73A49">-></span><span style="color: #6F42C1">close</span><span style="color: #24292E">();</span></span>
<span class="line"><span style="color: #24292E">$conn</span><span style="color: #D73A49">-></span><span style="color: #6F42C1">close</span><span style="color: #24292E">();</span></span>
<span class="line"></span></code></pre>
<p>Dạng <strong>bind</strong> param này chắc có lẽ sẽ khó để truyền tham số khi số lượng column cần dùng trong query trở nên nhiều hơn, vậy nên còn có cách như sau:</p>
<pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #6A737D">// Câu lệnh SQL chờ tham số</span></span>
<span class="line"><span style="color: #24292E">$sql </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #032F62">"</span><span style="color: #D73A49">SELECT</span><span style="color: #24292E"> </span><span style="color: #D73A49">*</span><span style="color: #24292E"> </span><span style="color: #D73A49">FROM</span><span style="color: #24292E"> USERS</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">WHERE</span><span style="color: #24292E"> email </span><span style="color: #D73A49">=</span><span style="color: #24292E"> :email</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">AND</span><span style="color: #24292E"> </span><span style="color: #D73A49">password</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> :</span><span style="color: #D73A49">password</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">LIMIT</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #032F62">"</span><span style="color: #24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// Chuẩn bị và ràng buộc</span></span>
<span class="line"><span style="color: #24292E">$stmt </span><span style="color: #D73A49">=</span><span style="color: #24292E"> $connection</span><span style="color: #D73A49">-></span><span style="color: #6F42C1">prepare</span><span style="color: #24292E">($sql);</span></span>
<span class="line"><span style="color: #24292E">$stmt</span><span style="color: #D73A49">-></span><span style="color: #6F42C1">bindParam</span><span style="color: #24292E">(</span><span style="color: #032F62">":email"</span><span style="color: #24292E">, $email);</span></span>
<span class="line"><span style="color: #24292E">$stmt</span><span style="color: #D73A49">-></span><span style="color: #6F42C1">bindParam</span><span style="color: #24292E">(</span><span style="color: #032F62">":password"</span><span style="color: #24292E">, $password);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// Truyền tham số và thực thi</span></span>
<span class="line"><span style="color: #24292E">$email </span><span style="color: #D73A49">=</span><span style="color: #24292E"> $_POST[</span><span style="color: #032F62">'email'</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">$password </span><span style="color: #D73A49">=</span><span style="color: #24292E"> $_POST[</span><span style="color: #032F62">'password'</span><span style="color: #24292E">];</span></span>
<span class="line"><span style="color: #24292E">$stmt</span><span style="color: #D73A49">-></span><span style="color: #6F42C1">execute</span><span style="color: #24292E">();</span></span>
<span class="line"></span></code></pre>
<p>Ví dụ trong một số ngôn ngữ khác:</p>
<p><strong>C#</strong></p>
<pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #6A737D">// Create the SQL command.</span></span>
<span class="line"><span style="color: #D73A49">SqlCommand</span><span style="color: #24292E"> </span><span style="color: #6F42C1">command</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">SqlCommand</span><span style="color: #24292E">(</span><span style="color: #032F62">"select * from users where email = @email"</span><span style="color: #24292E">, conn);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// Add the parameter values in separately.</span></span>
<span class="line"><span style="color: #24292E">command.Parameters.</span><span style="color: #6F42C1">Add</span><span style="color: #24292E">(</span><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #D73A49">SqlParameter</span><span style="color: #24292E">(</span><span style="color: #032F62">"email"</span><span style="color: #24292E">, email);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6F42C1">using</span><span style="color: #24292E"> (SqlDataReader reader </span><span style="color: #D73A49">=</span><span style="color: #24292E"> command.</span><span style="color: #6F42C1">ExecuteReader</span><span style="color: #24292E">())</span></span>
<span class="line"><span style="color: #24292E">{</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #6F42C1">while</span><span style="color: #24292E"> (reader.</span><span style="color: #6F42C1">Read</span><span style="color: #24292E">())</span></span>
<span class="line"><span style="color: #24292E">  {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D">// Do something with the retrieved data.</span></span>
<span class="line"><span style="color: #24292E">  }</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span></code></pre>
<p><strong>Django</strong></p>
<pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #6A737D"># Good</span></span>
<span class="line"><span style="color: #24292E">Users.objects.filter(</span><span style="color: #E36209">email</span><span style="color: #D73A49">=</span><span style="color: #24292E">email)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># Good</span></span>
<span class="line"><span style="color: #24292E">Users.objects.raw(</span><span style="color: #032F62">"select * from users where email = </span><span style="color: #005CC5">%s</span><span style="color: #032F62">"</span><span style="color: #24292E">, [email])</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D"># Liable to got hacked</span></span>
<span class="line"><span style="color: #24292E">Users.objects.raw(</span><span style="color: #032F62">"select * from users where email = '</span><span style="color: #005CC5">%s</span><span style="color: #032F62">'"</span><span style="color: #24292E"> </span><span style="color: #D73A49">%</span><span style="color: #24292E"> email)</span></span>
<span class="line"></span></code></pre>
<p><strong>Node</strong></p>
<pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #6A737D">// node-sql</span></span>
<span class="line"><span style="color: #D73A49">var</span><span style="color: #24292E"> sql </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">require</span><span style="color: #24292E">(</span><span style="color: #032F62">'sql'</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #D73A49">var</span><span style="color: #24292E"> query </span><span style="color: #D73A49">=</span><span style="color: #24292E"> user.</span><span style="color: #6F42C1">select</span><span style="color: #24292E">(user.</span><span style="color: #6F42C1">star</span><span style="color: #24292E">()))</span></span>
<span class="line"><span style="color: #24292E">                .</span><span style="color: #6F42C1">from</span><span style="color: #24292E">(user)</span></span>
<span class="line"><span style="color: #24292E">                .</span><span style="color: #6F42C1">where</span><span style="color: #24292E">(user.email.</span><span style="color: #6F42C1">equals</span><span style="color: #24292E">(email)).</span><span style="color: #6F42C1">toQuery</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A737D">// mysql</span></span>
<span class="line"><span style="color: #D73A49">var</span><span style="color: #24292E"> mysql </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">require</span><span style="color: #24292E">(</span><span style="color: #032F62">'mysql'</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #D73A49">var</span><span style="color: #24292E"> connection </span><span style="color: #D73A49">=</span><span style="color: #24292E"> mysql.</span><span style="color: #6F42C1">createConnection</span><span style="color: #24292E">({ host: </span><span style="color: #005CC5">HOST</span><span style="color: #24292E">, user: </span><span style="color: #005CC5">USERNAME</span><span style="color: #24292E">, password: </span><span style="color: #005CC5">PASSWORD</span><span style="color: #24292E"> });</span></span>
<span class="line"><span style="color: #24292E">connection.</span><span style="color: #6F42C1">connect</span><span style="color: #24292E">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">connection.</span><span style="color: #6F42C1">query</span><span style="color: #24292E">(</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #032F62">'select * from users where email = ?'</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">  [email],</span></span>
<span class="line"><span style="color: #24292E">  </span><span style="color: #D73A49">function</span><span style="color: #24292E">(</span><span style="color: #E36209">err</span><span style="color: #24292E">, </span><span style="color: #E36209">rows</span><span style="color: #24292E">, </span><span style="color: #E36209">fields</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D">// Do something with the retrieved data.</span></span>
<span class="line"><span style="color: #24292E">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">connection.</span><span style="color: #6F42C1">end</span><span style="color: #24292E">();</span></span>
<span class="line"></span></code></pre>
<h4 id="hãy-validation-từ-front-end-cho-tới-back-end">Hãy validation từ Front-end cho tới Back-end</h4>
<p><strong>Validation</strong> dữ liệu chưa bao giờ là công việc thú vị <img src="/assets/emoji/okay.png" emoji /> tuy nhiên việc validation 2 bước giúp bảo mật tốt hơn, và đồng thời cũng tránh được các lỗi lặt vặt không cần thiết.</p>
<p>Ví dụ trên front-end các field nhập vào dữ liệu số, nên dùng input <code>number</code> thay vì input <code>text</code>. Các field bắt buộc thì nên <code>required</code>. Mặc dù trên front-end có thể verify dữ liệu đầu vào, nhưng attacker vẫn có thể ignore những rule này để trực tiếp gửi dữ liệu vào back-end, vậy nên trên back-end chúng ta nên verify lại dữ liệu, như kiểu <code>$age = (int)$_POST['age']</code>. Điều này sẽ tránh được các yếu tố gây ra lỗi không đáng có.</p>
<h4 id="phân-quyền-quản-trị">Phân quyền quản trị</h4>
<p>Mình thấy rất nhiều bạn khi xây dựng project, thường sử dụng tài khoản <strong><code>root</code></strong> của DBMS để làm tất cả mọi thứ... Đó là một sai lầm cực kỳ lớn. Phần lớn các bạn đều chưa hiểu mức độ nghiêm trọng của vấn đề này, vấn đề này giải thích cũng khó hiểu, phải trong trường hợp thực tế các bạn học được thì dễ nhớ hơn.</p>
<p>Tuy nhiên mình vẫn sẽ đưa ra một ví dụ đơn giản như sau:</p>
<p>Khi bạn đăng nhập, việc cần làm của database chỉ là vào đọc dữ liệu (quyền <strong>READ</strong>) để verify thông tin. Trong khi các bạn lại cấp full quyền cho <strong>user</strong> của DBMS chỉ dùng để đọc... Giả sử form đăng nhập trên hệ thống có lỗ hổng SQL Injection, thì việc attack từ cái form login xoá toàn bộ dữ liệu của bạn là điều cực kỳ đơn giản, còn nếu user tương tác với database chỉ có quyền đọc, thì attacker cũng chỉ có thể truy cập tài khoản đó mà thôi.</p>
<p>Nghĩa là bạn chỉ gặp một nguy cơ nhỏ hơn so với cái nguy cơ cực kỳ khủng khiếp kia.</p>
<p>Đó, không phải tự dưng mà <strong>Oracle</strong> được cho là hệ quản trị database SQL bảo mật nhất, lý do là vì phân quyền của <strong>Oracle</strong> cực kỳ chặt chẽ. Do đó, tốt nhất nên phân quyền cho các user trong DBMS một cách chặt chẽ và hợp lý, để tránh hối hận về lâu về dài.</p>
<p>Vấn đề phân quyền không phải chỉ ở trong DBMS, mà còn ở trong cả hệ thống, và cấu hình <strong>server</strong>. Nhắc lại lần nữa: <strong>Phân quyền cực kỳ quan trọng</strong></p>
<p></p>
<h2 id="kết-luận">Kết luận</h2>
<p>SQL Injection không phải một vấn đề mới mẻ, nó tồn tại cả một thập kỷ rồi nhưng nó vẫn đứng đầu bảng xếp hạng về các lỗ hổng nguy hiểm nhất trong nhiều năm liền. Chỉ với một vài bước dễ dàng, hệ thống của bạn có thể bị tê liệt hoàn toàn... Chống thì khó, mà phá thì dễ lắm.</p>
<p>Nên nhớ:</p>
<blockquote>
<p>Đạo cao một thước, ma cao một trượng.</p>
</blockquote></div></article></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Mấy cái trò Database Hacking","date":"Mar 15, 2020","slug":"sql-database-hacking","content":"\u003cp\u003eHôm nọ mình vừa đọc được một bài write-up của một bạn white-hat sau khi báo cáo lại lỗ hổng SQL Injection trên trang web của Đại học Harvard, tự dưng thấy kỹ năng về bảo mật của mình bao lâu nay... kém ghê.\u003c/p\u003e\n\u003cp\u003eBản thân là sinh viên chuyên ngành \u003cstrong\u003eHệ Thống Thông Tin\u003c/strong\u003e, tức là chuyên ngồi đấu vật với mấy cái cơ sở dữ liệu mà lại rất hay quên đi những cái quan trọng như thế này... Cảm thấy xấu hổ, thế là mình phải mò lại những gì mình đã học, nhưng không dùng tới lại quên mất, rồi viết thành một blog để coi như vừa học lại, vừa chia sẻ kiến thức cho mọi người \u003cimg src=\"/assets/emoji/smug.png\" emoji /\u003e \u003cdel\u003eMình thật tuyệt\u003c/del\u003e\u003c/p\u003e\n\u003ch2 id=\"thằng-chó-mày-hack-web-bố-mày\"\u003eThằng chó, mày hack web bố mày...\u003c/h2\u003e\n\u003cp\u003eHè vừa rồi mình có trò chuyện với một ông anh trong nghề, ổng tâm sự về chuyện bị thằng nào thả bot nó clean mẹ cái database, để lại đúng một dòng duy nhất:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eGửi bố mày vài Bitcoin đê, bố mày trả lại dữ liệu cho... \u003cimg src=\"/assets/emoji/look_down.png\" emoji /\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eVà kèm theo đó là địa chỉ ví bitcoin của hắn \u003cimg src=\"/assets/emoji/surrender.png\" emoji /\u003e Tính ông anh mình được cái thật thà, nhà cũng không có gì ngoài điều kiện, thế là gửi cho nó vài bitcoin coi như tiền ăn sáng, hôm sau thấy nó restore lại dữ liệu thật \u003cimg src=\"/assets/emoji/mokas.png\" emoji /\u003e\u003c/p\u003e\n\u003cp\u003eNhưng mà tức quá, ai đời làm lập trình có sản phẩm đang chạy phà phà lại có thằng choá nào hack, nghĩ có cay không cơ chứ? \u003cimg src=\"/assets/emoji/yikes.png\" emoji /\u003e\u003c/p\u003e\n\u003cp\u003eMình không rõ là cái database đó bị hack như thế nào, nhưng khá chắc chắn phần lớn là bởi vì code chưa đủ bảo mật và có nhiều lỗ hổng. Các hacker sẽ viết một con bot chuyên đi dạo trên mạng để attack vào những case bảo mật thường dễ bị hack nhất.\u003c/p\u003e\n\u003cp\u003eVì vậy bài viết này mình sẽ giới thiệu cho các bạn một loại lỗ hổng \u003cstrong\u003ecơ bản\u003c/strong\u003e nhưng cực kỳ nguy hiểm, giải thích cơ chế và hướng dẫn cách phòng chống. Và xin giới thiệu cái trò gọi là \u003cstrong\u003eSQL Injection\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eLưu ý:\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eBài viết này nhằm mục đích giao lưu kỹ năng bảo mật lập trình, không cổ suý các bạn đi phá làng phá xóm. Hãy tỉnh táo \u003cimg src=\"/assets/emoji/smug.png\" emoji /\u003e\u003c/p\u003e\n\u003ch2 id=\"nhập-môn-hack-cơ-sở-dữ-liệu-sql\"\u003eNhập môn hack Cơ sở dữ liệu SQL\u003c/h2\u003e\n\u003cp\u003eTrong nhiều loại tấn công lỗ hổng nhằm vào website, tấn công \u003cstrong\u003eSQL Injection\u003c/strong\u003e là một trong những loại nguy hiểm và phổ biến nhất. Nó đã từng gây ra nhiều thiệt hại đáng kể cho nhiều doanh nghiệp và tổ chức trong rất nhiều năm, và đương nhiên sẽ còn tiếp diễn trong tương lai.\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eTheo \u003ca href=\"https://vi.wikipedia.org/wiki/SQL_injection\"\u003eWikipedia\u003c/a\u003e \u003cimg src=\"/assets/emoji/popcorn.png\" emoji /\u003e:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eSQL injection\u003c/strong\u003e là một kỹ thuật cho phép những kẻ tấn công lợi dụng lỗ hổng của việc kiểm tra dữ liệu đầu vào trong các ứng dụng web và các thông báo lỗi của hệ quản trị cơ sở dữ liệu trả về để \u003cem\u003einject\u003c/em\u003e (\u003cem\u003etiêm vào\u003c/em\u003e) và thi hành các câu lệnh SQL bất hợp pháp.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eỜ thì khái niệm như vậy đấy, hiểu một cách đơn giản tức là loại tấn công này nhằm vào các \u003cstrong\u003einput\u003c/strong\u003e có \u003cstrong\u003etương tác trực tiếp\u003c/strong\u003e với \u003cstrong\u003edatabase\u003c/strong\u003e ở \u003cstrong\u003eback-end\u003c/strong\u003e (ví dụ như các input email, password ở form login). Thông thường, attacker sẽ tấn công để ăn cắp dữ liệu, loại này về cơ bản là hiền nhất, sau đó tới xáo trộn dữ liệu để cản trở sự hoạt động của website, và trường hợp xấu nhất, là quyền truy cập quản trị vào máy chủ database bị chiếm. \u003cimg src=\"/assets/emoji/moka.png\" emoji /\u003e\u003c/p\u003e\n\u003cp\u003eTrong lịch sử, đã có rất nhiều đợt tấn công SQL Injection nhằm mục đích:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eTrích xuất thông tin nhạy cảm, ví dụ như về an sinh xã hội, hay thông tin thẻ tín dụng\u003c/li\u003e\n\u003cli\u003eTrích xuất thông tin người dùng đã được đăng ký trên các website, ở Việt Nam cũng không ít trường hợp\u003c/li\u003e\n\u003cli\u003eXoá luôn cái database, có rất nhiều trang web không sử dụng backup dữ liệu, và khi bị xoá thì coi như cả hệ thống tê liệt, ví dụ của ông anh bên trên là ví dụ gần gũi nhất\u003c/li\u003e\n\u003cli\u003eTiêm mã độc thực thi vào trang web khi người dùng truy cập\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eNhắc lại một lần nữa:\u003c/strong\u003e Tấn công về SQL Injection cực kỳ phổ biến. Các công ty lớn như \u003cstrong\u003eYahoo\u003c/strong\u003e hay \u003cstrong\u003eSony\u003c/strong\u003e đã từng là nhạn nhân của trò chơi này. Các nhóm hacker còn viết hẳn các script bot để tự đi tấn công dạo trên internet, vì vậy hãy luôn cẩn thận với sản phẩm của bạn.\u003c/p\u003e\n\u003ch3 id=\"cơ-chế-khai-thác-và-tấn-công\"\u003eCơ chế khai thác và tấn công\u003c/h3\u003e\n\u003cp\u003eSQL Injection tấn công bằng cách gửi một mã lệnh SQL độc đến back-end của máy chủ cơ sở đữ liệu, thông qua các request của người dùng mà website cho phép. Bất kỳ input nào cũng có thể được sử dụng để gửi mã độc, tức là bao gồm cả: các thẻ \u003ccode\u003e\u0026#x3C;input\u003e\u003c/code\u003e nhập liệu, query strings, cookies và file upload.\u003c/p\u003e\n\u003cp\u003eMình sẽ có một ví dụ như sau: Giả sử đây là trang đăng nhập vào ngân hàng \u003cstrong\u003ePankHub\u003c/strong\u003e, với form đăng nhập gồm 2 fields là \u003ccode\u003eemail\u003c/code\u003e và \u003ccode\u003epassword\u003c/code\u003e:\u003c/p\u003e\n\u003cp\u003eBây giờ mình sẽ thử đăng nhập tài khoản của người dùng tên là \u003cstrong\u003ePhát\u003c/strong\u003e (jk, don't panic) với \u003cem\u003eemail\u003c/em\u003e là: \u003ccode\u003ephat.nhagiau@pankhub.com\u003c/code\u003e và \u003cem\u003epassword\u003c/em\u003e là \u003ccode\u003epassword\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eỪ thì đương nhiên là không đăng nhập được rồi \u003cimg src=\"/assets/emoji/okay.png\" emoji /\u003e Đây là trường hợp giả sử mình là một attacker, và mình tình cờ địa được email của người dùng này sau khi đi ngang qua lúc nó đang đăng nhập vào ngân hàng ở tiệm net \u003cimg src=\"/assets/emoji/smug.png\" emoji /\u003e Victim của mình là một thằng đại gia nhà giàu, tiền không những được quy ra bằng vàng để trong két mà còn có cả một đống trong nhà băng. Xác định được mục tiêu thì trích xuất thông tin mục tiêu là điều cần thiết. Vì vậy mình chỉ thử đăng nhập cho vui thôi, đương nhiên làm gì có thằng \u003cdel\u003engu\u003c/del\u003e nào đặt mật khẩu là \u003ccode\u003epassword\u003c/code\u003e cơ chứ (jk)\u003c/p\u003e\n\u003cp\u003eBây giờ hãy nhìn vấn đề từ phía server log nhé, chúng ta sẽ có 1 cái logging như sau:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eRendering login page.\nChecking supplied authentication details for phat.nhagiau@pankhub.com.\nFinding user in database.\nNo such user, report this to the user (invalid credentials?).\nRendering login page.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSau đó, mình tiếp tục truy thử login vào tài khoản của victim, nhưng lần này password mình sẽ thêm một \u003cem\u003edấu nháy đơn\u003c/em\u003e \u003ccode\u003e'\u003c/code\u003e, kết quả có được là:\u003c/p\u003e\n\u003cp\u003eThấy sự khác biệt rồi phải không? Thông thường, với những trường hợp sai thông tin đăng nhập sẽ luôn cho ra một message lỗi (trang nào nó random message thì bó tay), vì vậy có gì đó không đúng xảy ra rồi, có thể nguyên do là bởi dấu nháy đơn chăng?\u003c/p\u003e\n\u003cp\u003eServer log:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e...\n\nRendering login page.\nChecking supplied authentication details for phat.nhagiau@pankhub.com.\nFinding user in database.\nAn error occurred: PG::SyntaxError: ERROR: unterminated quoted string at or near \"'password'' limit 1\" LINE 1: ...ers where email = 'phat.nhagiau@pankhub.com' and password = 'password'... ^ : select * from users where email = 'phat.nhagiau@pankhub.com' and password = 'password'' limit 1.\nUnable to login this user due to unexpected error.\nRendering login page.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNhìn thấy ở log hiển thị SQL syntax error chứ? Điều này chứng tỏ dấu nháy đơn chính là nguyên nhân gây ra lỗi. Thử ghép vào câu lệnh SQL được chạy trên server thì nó sẽ trông như thế này:\u003c/p\u003e\n\u003cpre class=\"shiki\" style=\"background-color: #fff\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eSELECT\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e*\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eFROM\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e users\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eWHERE\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e email \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e'phat.nhagiau@pankhub.com'\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eAND\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e pass  \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e'password'' LIMIT 1\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eDư 1 dấu nháy đơn, câu lệnh này chạy trong SQL chắc chắn sẽ lỗi. Và đây chính là thứ gọi là \u003cstrong\u003eSQL Injection\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eSau khi xác định được lỗ hổng, mình sẽ thử đăng nhập lại với password là \u003cstrong\u003e\u003ccode\u003e' OR 1=1--\u003c/code\u003e\u003c/strong\u003e. Câu lệnh SQL lúc này được thực thi trên server sẽ là:\u003c/p\u003e\n\u003cpre class=\"shiki\" style=\"background-color: #fff\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eSELECT\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e*\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eFROM\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e users\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eWHERE\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e email \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e'phat.nhagiau@pankhub.com'\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eAND\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e pass  \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e''\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eOR\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e1\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e1\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e--' LIMIT 1\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eServer log:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eRendering login page.\nChecking supplied authentication details for phat.nhagiau@pankhub.com.\nFinding user in database.\nAuthentication details confirmed, establishing session for this user.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eXong, tài khoản của bạn nằm trong tay tôi \u003cimg src=\"/assets/emoji/ok.png\" emoji /\u003e\u003c/p\u003e\n\u003cp\u003eCơ chế hoạt động đơn giản nhất của \u003cstrong\u003eSQL Injection\u003c/strong\u003e là như vậy đọ. Thực thi nó không hề khó, nhưng để nhận ra được trang nào có lỗ hổng thì lại khá khó, vì không phải lúc nào khai thác lỗ hổng SQL Injection nó cũng y chang như vậy.\u003c/p\u003e\n\u003ch3 id=\"nhưng-tại-sao-có-lỗ-hổng-này\"\u003eNhưng tại sao có lỗ hổng này?\u003c/h3\u003e\n\u003cp\u003eLý do lớn nhất là các bạn chưa thể tiếp cận toàn bộ các case trong quá trình code. Bạn không bao giờ lường trước được người dùng sẽ làm cái \u003cdel\u003eđéo\u003c/del\u003e gì trên sản phẩm của mình. \u003cimg src=\"/assets/emoji/sad.png\" emoji /\u003e Chính vì vậy thường các case không bao giờ được nghĩ tới này lại vô tình tạo ra lỗ hổng cho attacker khai thác.\u003c/p\u003e\n\u003cp\u003eKhi viết các câu lệnh SQL trong source (ở đây mình sẽ lấy \u003cstrong\u003ePHP\u003c/strong\u003e làm ví dụ), đa số các bạn thường viết kiểu:\u003c/p\u003e\n\u003cpre class=\"shiki\" style=\"background-color: #fff\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$query \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eSELECT\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e*\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eFROM\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e USERS\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eWHERE\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e email \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e'\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e $_POST[\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e'email'\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e] \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"'\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e  AND password = '\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e $_POST[\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e'password'\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e] \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e.\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"'\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #032F62\"\u003e  LIMIT 1;\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$result \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e $connection\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003equery\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e($sql);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eKhi người dùng gửi request đăng nhập có thông tin, thì câu query trên sẽ tương đương với:\u003c/p\u003e\n\u003cpre class=\"shiki\" style=\"background-color: #fff\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eSELECT\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e*\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eFROM\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e USERS\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eWHERE\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e email \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e'phat.nhagiau@pankhub.com'\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e   \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eAND\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003epassword\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e'password'\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eLIMIT\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e1\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTức là cái gì gửi lên, thì param tương đương sẽ được thay thế bằng cái đó. Điều này vô tình tạo ra một lỗ hổng cực kỳ nguy hiểm. Nếu bạn từng học các môn liên quan tới database hoặc làm việc với database nhiều, các bạn có thể hiểu rằng chỉ với những câu lệnh SQL thôi cũng đủ để chúng làm bất cứ thứ gì liên quan tới dữ liệu.\u003c/p\u003e\n\u003cp\u003eKhông những thế, SQL Injection còn có thể thực thi được mã HTML hoặc PHP trong nhiều trường hợp. Đó là lý do tại sao lỗ hổng này nghiêm trọng như vậy.\u003c/p\u003e\n\u003ch3 id=\"chống-injection-như-thế-nào\"\u003eChống injection như thế nào?\u003c/h3\u003e\n\u003ch4 id=\"truy-vấn-tham-số-parameterized-statements\"\u003eTruy vấn tham số (Parameterized Statements)\u003c/h4\u003e\n\u003cp\u003eĐa số các ngôn ngữ lập trình hỗ trợ truy vấn SQL đều sẽ hỗ trợ chạy các câu lệnh SQL bằng cách tạo truy vấn để trích xuất các tham số khi cần thiết. Các câu lệnh nên được \u003cem\u003etham số hoá\u003c/em\u003e để đảm bảo rằng các \u003cem\u003etham số\u003c/em\u003e (tức là \u003cem\u003edữ liệu đầu vào\u003c/em\u003e) đưa vào câu lệnh SQL được xử lý một cách an toàn nhất.\u003c/p\u003e\n\u003cp\u003eVới ví dụ ở \u003ca href=\"#nh%c6%b0ng-t%e1%ba%a1i-sao-c%c3%b3-l%e1%bb%97-h%e1%bb%95ng-n%c3%a0y\"\u003ephần trên\u003c/a\u003e, chúng ta sẽ thử đưa nó về dạng truy vấn tham số:\u003c/p\u003e\n\u003cpre class=\"shiki\" style=\"background-color: #fff\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e// Câu lệnh SQL chờ tham số\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$sql \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eSELECT\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e*\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eFROM\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e USERS\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eWHERE\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e email \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e ?\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eAND\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003epassword\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e ?\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eLIMIT\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e1\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e// Chuẩn bị và ràng buộc\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$stmt \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e $connection\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eprepare\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e($sql);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$stmt\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003ebind_param\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"ss\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, $email, $password);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e// Truyền tham số và thực thi\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$email \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e $_POST[\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e'email'\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$password \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e $_POST[\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e'password'\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$stmt\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eexecute\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e// Đừng quên close connection mỗi lần thực thi xong\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$stmt\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eclose\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$conn\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eclose\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eDạng \u003cstrong\u003ebind\u003c/strong\u003e param này chắc có lẽ sẽ khó để truyền tham số khi số lượng column cần dùng trong query trở nên nhiều hơn, vậy nên còn có cách như sau:\u003c/p\u003e\n\u003cpre class=\"shiki\" style=\"background-color: #fff\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e// Câu lệnh SQL chờ tham số\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$sql \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eSELECT\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e*\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eFROM\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e USERS\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eWHERE\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e email \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e :email\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eAND\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003epassword\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e :\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003epassword\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eLIMIT\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e1\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e// Chuẩn bị và ràng buộc\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$stmt \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e $connection\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eprepare\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e($sql);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$stmt\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003ebindParam\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\":email\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, $email);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$stmt\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003ebindParam\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\":password\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, $password);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e// Truyền tham số và thực thi\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$email \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e $_POST[\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e'email'\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$password \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e $_POST[\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e'password'\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$stmt\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eexecute\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eVí dụ trong một số ngôn ngữ khác:\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eC#\u003c/strong\u003e\u003c/p\u003e\n\u003cpre class=\"shiki\" style=\"background-color: #fff\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e// Create the SQL command.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eSqlCommand\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003ecommand\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003enew\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eSqlCommand\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"select * from users where email = @email\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, conn);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e// Add the parameter values in separately.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003ecommand.Parameters.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eAdd\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003enew\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eSqlParameter\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"email\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, email);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6F42C1\"\u003eusing\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e (SqlDataReader reader \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e command.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eExecuteReader\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003ewhile\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e (reader.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eRead\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e// Do something with the retrieved data.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eDjango\u003c/strong\u003e\u003c/p\u003e\n\u003cpre class=\"shiki\" style=\"background-color: #fff\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# Good\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003eUsers.objects.filter(\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003eemail\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003eemail)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# Good\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003eUsers.objects.raw(\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"select * from users where email = \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e%s\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, [email])\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e# Liable to got hacked\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003eUsers.objects.raw(\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"select * from users where email = '\u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e%s\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e'\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e%\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e email)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eNode\u003c/strong\u003e\u003c/p\u003e\n\u003cpre class=\"shiki\" style=\"background-color: #fff\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e// node-sql\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003evar\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e sql \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003erequire\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e'sql'\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003evar\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e query \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e user.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eselect\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(user.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003estar\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e()))\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e                .\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003efrom\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(user)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e                .\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003ewhere\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(user.email.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eequals\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(email)).\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003etoQuery\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e// mysql\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003evar\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e mysql \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003erequire\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e'mysql'\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003evar\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e connection \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e mysql.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003ecreateConnection\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e({ host: \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eHOST\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, user: \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eUSERNAME\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, password: \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003ePASSWORD\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003econnection.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003econnect\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003econnection.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003equery\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e'select * from users where email = ?'\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  [email],\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003eerr\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003erows\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003efields\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e// Do something with the retrieved data.\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e  });\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003econnection.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eend\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e();\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"hãy-validation-từ-front-end-cho-tới-back-end\"\u003eHãy validation từ Front-end cho tới Back-end\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003eValidation\u003c/strong\u003e dữ liệu chưa bao giờ là công việc thú vị \u003cimg src=\"/assets/emoji/okay.png\" emoji /\u003e tuy nhiên việc validation 2 bước giúp bảo mật tốt hơn, và đồng thời cũng tránh được các lỗi lặt vặt không cần thiết.\u003c/p\u003e\n\u003cp\u003eVí dụ trên front-end các field nhập vào dữ liệu số, nên dùng input \u003ccode\u003enumber\u003c/code\u003e thay vì input \u003ccode\u003etext\u003c/code\u003e. Các field bắt buộc thì nên \u003ccode\u003erequired\u003c/code\u003e. Mặc dù trên front-end có thể verify dữ liệu đầu vào, nhưng attacker vẫn có thể ignore những rule này để trực tiếp gửi dữ liệu vào back-end, vậy nên trên back-end chúng ta nên verify lại dữ liệu, như kiểu \u003ccode\u003e$age = (int)$_POST['age']\u003c/code\u003e. Điều này sẽ tránh được các yếu tố gây ra lỗi không đáng có.\u003c/p\u003e\n\u003ch4 id=\"phân-quyền-quản-trị\"\u003ePhân quyền quản trị\u003c/h4\u003e\n\u003cp\u003eMình thấy rất nhiều bạn khi xây dựng project, thường sử dụng tài khoản \u003cstrong\u003e\u003ccode\u003eroot\u003c/code\u003e\u003c/strong\u003e của DBMS để làm tất cả mọi thứ... Đó là một sai lầm cực kỳ lớn. Phần lớn các bạn đều chưa hiểu mức độ nghiêm trọng của vấn đề này, vấn đề này giải thích cũng khó hiểu, phải trong trường hợp thực tế các bạn học được thì dễ nhớ hơn.\u003c/p\u003e\n\u003cp\u003eTuy nhiên mình vẫn sẽ đưa ra một ví dụ đơn giản như sau:\u003c/p\u003e\n\u003cp\u003eKhi bạn đăng nhập, việc cần làm của database chỉ là vào đọc dữ liệu (quyền \u003cstrong\u003eREAD\u003c/strong\u003e) để verify thông tin. Trong khi các bạn lại cấp full quyền cho \u003cstrong\u003euser\u003c/strong\u003e của DBMS chỉ dùng để đọc... Giả sử form đăng nhập trên hệ thống có lỗ hổng SQL Injection, thì việc attack từ cái form login xoá toàn bộ dữ liệu của bạn là điều cực kỳ đơn giản, còn nếu user tương tác với database chỉ có quyền đọc, thì attacker cũng chỉ có thể truy cập tài khoản đó mà thôi.\u003c/p\u003e\n\u003cp\u003eNghĩa là bạn chỉ gặp một nguy cơ nhỏ hơn so với cái nguy cơ cực kỳ khủng khiếp kia.\u003c/p\u003e\n\u003cp\u003eĐó, không phải tự dưng mà \u003cstrong\u003eOracle\u003c/strong\u003e được cho là hệ quản trị database SQL bảo mật nhất, lý do là vì phân quyền của \u003cstrong\u003eOracle\u003c/strong\u003e cực kỳ chặt chẽ. Do đó, tốt nhất nên phân quyền cho các user trong DBMS một cách chặt chẽ và hợp lý, để tránh hối hận về lâu về dài.\u003c/p\u003e\n\u003cp\u003eVấn đề phân quyền không phải chỉ ở trong DBMS, mà còn ở trong cả hệ thống, và cấu hình \u003cstrong\u003eserver\u003c/strong\u003e. Nhắc lại lần nữa: \u003cstrong\u003ePhân quyền cực kỳ quan trọng\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003ch2 id=\"kết-luận\"\u003eKết luận\u003c/h2\u003e\n\u003cp\u003eSQL Injection không phải một vấn đề mới mẻ, nó tồn tại cả một thập kỷ rồi nhưng nó vẫn đứng đầu bảng xếp hạng về các lỗ hổng nguy hiểm nhất trong nhiều năm liền. Chỉ với một vài bước dễ dàng, hệ thống của bạn có thể bị tê liệt hoàn toàn... Chống thì khó, mà phá thì dễ lắm.\u003c/p\u003e\n\u003cp\u003eNên nhớ:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eĐạo cao một thước, ma cao một trượng.\u003c/p\u003e\n\u003c/blockquote\u003e","image":"/assets/blog/sql-database-hacking/featured.jpg","tags":["web","database","hacking","security"]}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"sql-database-hacking"},"buildId":"EoFBNuKZQIZTtRXAUTpDc","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>