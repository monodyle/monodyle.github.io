<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#24292e"/><meta name="apple-mobile-web-app-title" content="The Monody\&#x27;s Blog"/><meta name="application-name" content="The Monody\&#x27;s Blog"/><meta name="msapplication-TileColor" content="#1366E9"/><meta name="theme-color" content="#ffffff"/><title>Tôi đã viết ĐKHP Helper như thế nào?</title><meta name="title" content="Tôi đã viết ĐKHP Helper như thế nào?"/><meta name="description" content="Cứ 9h sáng, kỳ nào cũng thế, không có sự khoan nhượng nào, một trận chiến khốc liệt, đẫm máu, tất cả vỏn vẹn chưa tới một giây..."/><meta name="image" content="https://monodyle.github.io/blog/toi-da-viet-dkhp-helper-nhu-the-nao/featured.jpg"/><meta property="og:url" content="https://monodyle.github.io/blog/toi-da-viet-dkhp-helper-nhu-the-nao"/><meta property="og:type" content="website"/><meta property="og:title" content="Tôi đã viết ĐKHP Helper như thế nào?"/><meta property="og:description" content="Cứ 9h sáng, kỳ nào cũng thế, không có sự khoan nhượng nào, một trận chiến khốc liệt, đẫm máu, tất cả vỏn vẹn chưa tới một giây..."/><meta property="og:image" content="https://monodyle.github.io/blog/toi-da-viet-dkhp-helper-nhu-the-nao/featured.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="Monody Le"/><meta name="twitter:title" content="Tôi đã viết ĐKHP Helper như thế nào?"/><meta name="twitter:description" content="Cứ 9h sáng, kỳ nào cũng thế, không có sự khoan nhượng nào, một trận chiến khốc liệt, đẫm máu, tất cả vỏn vẹn chưa tới một giây..."/><meta name="twitter:image" content="https://monodyle.github.io/blog/toi-da-viet-dkhp-helper-nhu-the-nao/featured.jpg"/><meta name="next-head-count" content="25"/><link rel="preload" href="/_next/static/css/ba532866a37d159cf218.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ba532866a37d159cf218.css"/><link rel="preload" href="/_next/static/chunks/main-7268da2420ae7ee3cbc5.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-488dc228921f1fdbc0e7.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.8e39f187f5de284a7e93.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.9233c5a7222f426c41fb.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-ab6a323af59c0bc98c4c.js" as="script"/><link rel="preload" href="/_next/static/chunks/05d954cf.8590707d2bd7065d9eb0.js" as="script"/><link rel="preload" href="/_next/static/chunks/fb55e402fbac2b3f5997de739cc6df0392f34ac4.229205e32f8ecc5ab44d.js" as="script"/><link rel="preload" href="/_next/static/chunks/c70a8af0150c67be23b7e2c359c8a02097d385df.c76d0204478302340b0d.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/toi-da-viet-dkhp-helper-nhu-the-nao-06241d373a45d20d092c.js" as="script"/></head><body><div id="__next"><div class="w-full text-black bg-white"><header class="w-full"><div class="container pt-16"><a class="flex items-center mb-2" href="/"><img src="/favicon-32x32.png" alt="logo"/><strong class="pl-2 font-mono">The Monody&#x27;s Blog</strong></a><nav class="hidden tablet:block"><div class="flex items-center font-mono"><div><a href="/"><span class="text-black">Home</span></a><span class="px-4">/</span></div><div><a href="/about"><span class="text-black">About</span></a><span class="px-4">/</span></div><div><a href="https://ko-fi.com/monodyle" target="_blank"><span class="text-black">☕ Buy me a coffee</span></a></div></div></nav></div></header><main class="pb-16"><div class="container"><div class="mt-8" style="opacity:0;transform:translateY(100px) translateZ(0)"><article><h1 class="mb-10 text-3xl">Tôi đã viết ĐKHP Helper như thế nào?</h1><div class="mb-10 bg-light-gray desktop:-mx-24"><img src="/blog/toi-da-viet-dkhp-helper-nhu-the-nao/featured.jpg" alt="Tôi đã viết ĐKHP Helper như thế nào?" title="Tôi đã viết ĐKHP Helper như thế nào?"/></div><div class="flex justify-between"><time class="block mb-10 font-mono text-black">Aug 07, 2019</time><div class="flex justify-end tag-group"><span class="mr-4 font-mono font-medium text-black tag">dev</span><span class="mr-4 font-mono font-medium text-black tag">web</span><span class="mr-4 font-mono font-medium text-black tag">javascript</span></div></div><div id="content"><h2><span id="ngày-xửa-ngày-xưa" class="absolute invisible block pt-8 -mt-8"></span><a href="#ngày-xửa-ngày-xưa">Ngày xửa ngày xưa...</a><svg width="16" height="24" stroke-width="1.5"><use xlink:href="/assets/icons.svg#link"></use></svg></h2><p>Cứ 9h sáng, kỳ nào cũng thế, không có sự khoan nhượng nào, một trận chiến khốc liệt trên xa trường, tất cả vỏn vẹn chưa tới một giây...</p><p>Sau đó thì web sập. Đấy là thứ mà sinh viên <strong>UIT</strong> vẫn gọi là <strong>Đăng ký học phần</strong>. Vừa mở đăng ký, sinh viên lùa vào như siêu thị sale sản phẩm 100%, ai cũng muốn giành cho mình chỗ tốt, mọi việc cứ thế mà lộn tùng phèo hết cả lên. Ai may mắn nhanh tay thì giành trước, kẻ nào xui xẻo đến sau... coi như khó có cơ hội.</p><p>Mình cũng từng như thế, tranh giành khốc liệt, server phía bên trường sập vẫn cứ sập, sinh viên thấy server sập lại cứ thế mà <strong>F5</strong>, mà càng F5 thì cache càng nặng, server càng nhiều request, thế lại càng sập, mà càng sập lại càng khó để đăng ký. Haizz, trước tình cảnh năm nhất và kỳ I năm 2 không thể đăng ký được những gì mình mong muốn. Ấm ức mãi cũng chả giải quyết gì, nhìn nhiều đứa chửi đổng cũng thở dài, cũng nghe nhạc Mr.Siro nhìn ra cửa sổ trầm tư về cuộc sống thường nhật. Bên cạnh vẫn là chiếc laptop hiển thị lỗi, cảm giác cuộc sống đôi khi vô vị.</p><p>Xem cái meme nghỉ mắt tý</p><figure class="flex flex-col items-center max-w-full my-10 tablet:my-12 desktop:my-16"><img alt="Meme nghỉ mắt tý" data-src="https://i.imgur.com/4h8ssQu.png" class="lazyload"/><figcaption class="px-2 mt-4 text-xs tracking-wide text-center tablet:text-sm desktop:text-base">Meme nghỉ mắt tý</figcaption></figure><p>Tự dưng lúc đó chẹp lưỡi, bảo giá như có thằng nào canh hộ mình, đỡ mất công ngồi đây canh.... Thế mà quên mất mình là dân CNTT, tại sao không giải quyết bằng phương pháp Công nghệ Thông tin? Thế là lại lọ mọ ngồi code, cứ thế mà quên mất đang phải ĐKHP, cứ thế mà ĐKHP Helper đã ra đời.</p><h2><span id="từ-ý-tưởng-tới-thực-tế" class="absolute invisible block pt-8 -mt-8"></span><a href="#từ-ý-tưởng-tới-thực-tế">Từ ý tưởng tới thực tế</a><svg width="16" height="24" stroke-width="1.5"><use xlink:href="/assets/icons.svg#link"></use></svg></h2><p>Phác thảo ý tưởng: Ý tưởng ban đầu là spam request <strong>liên tục</strong> lên server để giành slot trước, tuy nhiên việc spam một số lượng request lớn sẽ làm server nặng thêm, chưa kể nếu server <strong>limit request</strong> thì mình chết chắc. Thế nên phải giãn khoảng cách các request ra. Trước hết là phải viết get request lấy thông tin form để thực hiện post request tiếp theo. Sau đó post request theo token và các thông tin cần thiết trong form kèm danh sách lớp mong muốn lên server, rồi nhận response để kiểm tra việc đăng ký đã hoàn thành hay chưa? Nếu đã đăng ký thành công thì log ra 1 thông báo, cùng việc xóa môn học đó ra khỏi danh sách cần đăng ký, thực hiện lại vòng lặp với các môn học chưa được hoàn thành.</p><p>Nói sơ sơ thì chắc mọi người cũng hiểu về bản chất của tool này: Thay thế tay người làm một loạt các hành động thay vì phải ngồi trực và click bằng tay, chứ không phải khai thác lỗi dữ liệu để chiếm slot. Việc một thao tác bằng tay sẽ tốn nhiều thời gian hơn gấp trăm/ngàn lần so với việc để máy thực hiện thao tác giúp chúng ta.</p><figure class="flex flex-col items-center max-w-full my-10 tablet:my-12 desktop:my-16"><img alt="Request Request Request" data-src="https://i.imgur.com/ujWzizu.png" class="lazyload"/><figcaption class="px-2 mt-4 text-xs tracking-wide text-center tablet:text-sm desktop:text-base">Request Request Request</figcaption></figure><p>Bắt tay viết code nào.</p><p>Đầu tiên là một get request để lấy thông form đăng ký học phần, ở đây mình sẽ sử dụng <strong>ajax</strong> để request lên trang đkhp</p><pre><div class="mb-10 mt-4 pb-4 overflow-x-auto border border-mid-gray rounded-sm pt-4"><code class="block float-left min-w-full px-4"><span style="color:#D73A49">var</span><span style="color:#000000"> request </span><span style="color:#D73A49">=</span><span style="color:#000000"> $.</span><span style="color:#6F42C1">ajax</span><span style="color:#000000">({</span>
<span style="color:#000000">    url</span><span style="color:#D73A49">:</span><span style="color:#000000"> </span><span style="color:#22863A">&quot;https://dkhp.uit.edu.vn/sinhvien/hocphan/dangky&quot;</span><span style="color:#000000">,</span>
<span style="color:#000000">    type</span><span style="color:#D73A49">:</span><span style="color:#000000"> </span><span style="color:#22863A">&quot;get&quot;</span>
<span style="color:#000000">});</span>
<!-- -->
<span style="color:#D73A49">var</span><span style="color:#000000"> formData </span><span style="color:#D73A49">=</span><span style="color:#000000"> request.</span><span style="color:#6F42C1">done</span><span style="color:#000000">(</span><span style="color:#D73A49">function</span><span style="color:#000000">(response) {</span>
<span style="color:#000000">    </span><span style="color:#005CC5">console</span><span style="color:#000000">.</span><span style="color:#005CC5">log</span><span style="color:#000000">(response);</span>
<span style="color:#000000">});</span>
</code></div></pre><p>Nếu các bạn đã dùng ajax, hẳn sẽ biết việc <strong>request</strong> của ajax bản chất vẫn là load cả một website ra, vì thế nên response của chúng ta là một file text bao gồm html của một trang web, khá giống vơi việc bạn vào trang <a href="https://dkhp.uit.edu.vn/sinhvien/hocphan/dangky" target="_blank" rel="noopener noreferrer" class="no-underline text-primary">đăng ký</a> rồi <strong>Ctrl + U</strong> để lấy source trang web. Thế nên thời gian request của ajax và thời gian dùng browser request là tương đương, tốc độ hơn ở đây là xử lý thông tin và không tốn thời gian browser <strong>render DOM</strong> ra màn hình người dùng.</p><p>Tuy nhiên vì vẫn sẽ có những lúc server sập, thế nên chúng ta phải phòng hờ trường hợp này bằng cách bắt lỗi từ ajax</p><figure class="flex flex-col items-center max-w-full my-10 tablet:my-12 desktop:my-16"><img alt="Lỗi khi request" data-src="https://i.imgur.com/K63jLcw.png" class="lazyload"/><figcaption class="px-2 mt-4 text-xs tracking-wide text-center tablet:text-sm desktop:text-base">Lỗi khi request</figcaption></figure><pre><div class="mb-10 mt-4 pb-4 overflow-x-auto border border-mid-gray rounded-sm pt-4"><code class="block float-left min-w-full px-4"><span style="color:#000000">request.</span><span style="color:#6F42C1">fail</span><span style="color:#000000">(</span><span style="color:#D73A49">function</span><span style="color:#000000"> (xhr, status, errorThrown){</span>
<span style="color:#000000">    </span><span style="color:#6A737D">// Log the error to the console</span>
<span style="color:#000000">    </span><span style="color:#005CC5">console</span><span style="color:#000000">.</span><span style="color:#005CC5">error</span><span style="color:#000000">(</span>
<span style="color:#000000">        </span><span style="color:#22863A">&quot;The following error occurred: &quot;</span><span style="color:#000000"> </span><span style="color:#D73A49">+</span><span style="color:#000000"> status, errorThrown</span>
<span style="color:#000000">    );</span>
<span style="color:#000000">});</span>
</code></div></pre><p>Bước thứ 2, lấy thông tin trong form. Việc các bạn gửi thông tin trong bất kỳ form nào: Đăng nhập, đăng ký, post bài lên facebook, tạo group mới, gửi email, hầu như đều cần một vài thứ thông tin, quan trọng nhất là <strong>token</strong> đối với những form yêu cầu tính bảo mật cao và cũng là thứ để chống spam, chúng thường được lưu trong các hidden input nên ở giao diện sẽ không được hiển thị, nhưng toàn bộ các input có name trong form đều sẽ được gửi như một thông tin kèm theo lên server. Thế nên không thể thiếu những thông tin này.</p><figure class="flex flex-col items-center max-w-full my-10 tablet:my-12 desktop:my-16"><img alt="form token" data-src="https://i.imgur.com/KTr5Pg6.png" class="lazyload"/><figcaption class="px-2 mt-4 text-xs tracking-wide text-center tablet:text-sm desktop:text-base">form token</figcaption></figure><p>Thông tin tiếp theo chúng ta cần là những môn học cần đăng ký.</p><pre><div class="mb-10 mt-4 pb-4 overflow-x-auto border border-mid-gray rounded-sm pt-4"><code class="block float-left min-w-full px-4"><span style="color:#D73A49">var</span><span style="color:#000000"> ClassList </span><span style="color:#D73A49">=</span><span style="color:#000000"> [</span><span style="color:#22863A">&#x27;IS401.K11&#x27;</span><span style="color:#000000">, </span><span style="color:#22863A">&#x27;IS402.K11&#x27;</span><span style="color:#000000">, </span><span style="color:#22863A">&#x27;IS405.K11&#x27;</span><span style="color:#000000">, </span><span style="color:#22863A">&#x27;IS405.K11.1&#x27;</span><span style="color:#000000">];</span>
</code></div></pre><p>Phương thức đăng ký, trong trang ĐKHP của UIT có 2 kiểu đăng ký:</p><p>1 là check vào checkbox ở những môn mình muốn học rồi đăng ký.</p><figure class="flex flex-col items-center max-w-full my-10 tablet:my-12 desktop:my-16"><img alt="dkhp cách 1" data-src="https://i.imgur.com/vNMFO8e.png" class="lazyload"/><figcaption class="px-2 mt-4 text-xs tracking-wide text-center tablet:text-sm desktop:text-base">dkhp cách 1</figcaption></figure><p>2 là sử dụng mã môn học, lập 1 danh sách rồi bỏ vào textarea ở khung đăng ký nhanh rồi đăng ký:</p><figure class="flex flex-col items-center max-w-full my-10 tablet:my-12 desktop:my-16"><img alt="dkhp cách 2" data-src="https://i.imgur.com/QaTeegB.png" class="lazyload"/><figcaption class="px-2 mt-4 text-xs tracking-wide text-center tablet:text-sm desktop:text-base">dkhp cách 2</figcaption></figure><p>Chúng ta phải chọn 1 trong 2 cách để gửi dữ liệu, gửi cả 2 cũng được, nhưng chả ai gửi cả 2 làm gì, lỡ server xử lý cồng kềnh hơn, đâm ra chậm hơn à?</p><p>Nếu sử dụng cách 1, chúng ta phải đi check từng cái input để kiếm cái nào phù hợp với danh sách của mình, sau đó lấy dữ liệu từ đó mà post request.</p><figure class="flex flex-col items-center max-w-full my-10 tablet:my-12 desktop:my-16"><img alt="Cách 1" data-src="https://i.imgur.com/Z9q6sHR.png" class="lazyload"/><figcaption class="px-2 mt-4 text-xs tracking-wide text-center tablet:text-sm desktop:text-base">Cách 1</figcaption></figure><p>Thử inspect xem thử, có vẻ chúng ta sẽ có một name để dùng làm thông tin đăng ký.</p><figure class="flex flex-col items-center max-w-full my-10 tablet:my-12 desktop:my-16"><img alt="Inspect mã lớp" data-src="https://i.imgur.com/78QFkzO.png" class="lazyload"/><figcaption class="px-2 mt-4 text-xs tracking-wide text-center tablet:text-sm desktop:text-base">Inspect mã lớp</figcaption></figure><p>Nhưng mà parse HTML ra sương sương cũng thấy gần 10.000 line, thế nên việc dò thế này khá tốn kém.</p><p>Đối với cách 2 chỉ cần 1 cái textarea, mà mình đa đề cập bất kỳ một cái input nào trong form cũng sẽ có name riêng của nó, việc nhập liệu cũng khá dễ, thế nên mình prefer cách thứ 2 hơn.</p><figure class="flex flex-col items-center max-w-full my-10 tablet:my-12 desktop:my-16"><img alt="Cách 2" data-src="https://i.imgur.com/9fFCa0R.png" class="lazyload"/><figcaption class="px-2 mt-4 text-xs tracking-wide text-center tablet:text-sm desktop:text-base">Cách 2</figcaption></figure><p>Việc cần làm còn lại là post tất cả thông tin chúng ta có lên server đkhp để nhận response.</p><pre><div class="mb-10 mt-4 pb-4 overflow-x-auto border border-mid-gray rounded-sm pt-4"><code class="block float-left min-w-full px-4"><span style="color:#D73A49">var</span><span style="color:#000000"> post </span><span style="color:#D73A49">=</span><span style="color:#000000"> $.</span><span style="color:#6F42C1">ajax</span><span style="color:#000000">({</span>
<span style="color:#000000">    url</span><span style="color:#D73A49">:</span><span style="color:#000000"> </span><span style="color:#22863A">&quot;https://dkhp.uit.edu.vn/sinhvien/hocphan/dangky&quot;</span><span style="color:#000000">,</span>
<span style="color:#000000">    type</span><span style="color:#D73A49">:</span><span style="color:#000000"> </span><span style="color:#22863A">&quot;POST&quot;</span><span style="color:#000000">,</span>
<span style="color:#000000">    data</span><span style="color:#D73A49">:</span><span style="color:#000000"> {</span>
<span style="color:#000000">        </span><span style="color:#6A737D">/*</span>
<span style="color:#6A737D">            txtmasv: auth.name,</span>
<span style="color:#6A737D">            form_build_id: form_build_id,</span>
<span style="color:#6A737D">            form_token: form_token,</span>
<span style="color:#6A737D">            form_id: &#x27;uit_dkhp_dangky_form&#x27;,</span>
<span style="color:#6A737D">            ...</span>
<span style="color:#6A737D">         */</span>
<span style="color:#000000">        </span><span style="color:#6A737D">// everything you got here</span>
<span style="color:#000000">    }</span>
<span style="color:#000000">});</span>
<!-- -->
<span style="color:#D73A49">var</span><span style="color:#000000"> response </span><span style="color:#D73A49">=</span><span style="color:#000000"> post.</span><span style="color:#6F42C1">done</span><span style="color:#000000">(</span><span style="color:#D73A49">function</span><span style="color:#000000">(xhr, status) {</span>
<span style="color:#000000">    </span><span style="color:#005CC5">console</span><span style="color:#000000">.</span><span style="color:#005CC5">log</span><span style="color:#000000">(status);</span>
<span style="color:#000000">}).</span><span style="color:#6F42C1">fail</span><span style="color:#000000">(</span><span style="color:#D73A49">function</span><span style="color:#000000"> (xhr, status, error) { </span><span style="color:#6A737D">// dont forget the error</span>
<span style="color:#000000">    </span><span style="color:#005CC5">console</span><span style="color:#000000">.</span><span style="color:#005CC5">error</span><span style="color:#000000">(status, error);</span>
<span style="color:#000000">});</span>
</code></div></pre><p>Thử nghiệm nay nàoooo</p><figure class="flex flex-col items-center max-w-full my-10 tablet:my-12 desktop:my-16"><img alt="Kết quả thử nghiệm" data-src="https://i.imgur.com/2drvjYk.png" class="lazyload"/><figcaption class="px-2 mt-4 text-xs tracking-wide text-center tablet:text-sm desktop:text-base">Kết quả thử nghiệm</figcaption></figure><p>Có vẻ khá ổn, bây giờ thì chúng ta phải kiểm tra danh sách các môn học đã được đăng ký thành công, và loại bỏ chúng ra khỏi danh sách request.</p><p>Chúng ta có response trả về từ post request, có một mớ đống hổ lốn đó thì việc check khá dễ dàng, thử inspect các lớp đã đăng ký ta sẽ thấy input name khác với những lớp còn lại:</p><figure class="flex flex-col items-center max-w-full my-10 tablet:my-12 desktop:my-16"><img alt="Các lớp đã đăng ký" data-src="https://i.imgur.com/lucgRiq.png" class="lazyload"/><figcaption class="px-2 mt-4 text-xs tracking-wide text-center tablet:text-sm desktop:text-base">Các lớp đã đăng ký</figcaption></figure><p>Việc cần làm là check làm sao? Lúc này phải dùng <strong>RegEx</strong> thần thánh rồi :evil_laugh:</p><pre><div class="mb-10 mt-4 pb-4 overflow-x-auto border border-mid-gray rounded-sm pt-4"><code class="block float-left min-w-full px-4"><span style="color:#D73A49">new</span><span style="color:#000000"> </span><span style="color:#6F42C1">RegExp</span><span style="color:#000000">(</span><span style="color:#22863A">&quot;table_lophoc_dadk\\[&quot;</span><span style="color:#000000"> </span><span style="color:#D73A49">+</span><span style="color:#000000"> subject_id.</span><span style="color:#005CC5">replace</span><span style="color:#000000">(</span><span style="color:#22863A">&quot;.&quot;</span><span style="color:#000000">, </span><span style="color:#22863A">&quot;\\.&quot;</span><span style="color:#000000">) </span><span style="color:#D73A49">+</span><span style="color:#000000"> </span><span style="color:#22863A">&quot;\\]&quot;</span><span style="color:#000000">);</span>
</code></div></pre><p>Check xong lưu array vào một variable tạm gọi là <code>registered</code>, sau đó lần lượt vứt chúng ra khỏi danh sách lớp ban đầu</p><pre><div class="mb-10 mt-4 pb-4 overflow-x-auto border border-mid-gray rounded-sm pt-4"><code class="block float-left min-w-full px-4"><span style="color:#D73A49">for</span><span style="color:#000000"> (</span><span style="color:#D73A49">var</span><span style="color:#000000"> subject </span><span style="color:#D73A49">in</span><span style="color:#000000"> registered) {</span>
<span style="color:#000000">    </span><span style="color:#D73A49">if</span><span style="color:#000000"> (ClassList.</span><span style="color:#6F42C1">includes</span><span style="color:#000000">(subject)) ClassList.</span><span style="color:#005CC5">splice</span><span style="color:#000000">(ClassList.</span><span style="color:#005CC5">indexOf</span><span style="color:#000000">(subject), </span><span style="color:#005CC5">1</span><span style="color:#000000">);</span>
<span style="color:#000000">}</span>
</code></div></pre><p>Yé, coi như xong ĐKHP Helper rồi đó.</p><em>Nhưng...</em><h2><span id="làm-gì-có-việc-nào-dễ-dàng-bao-giờ" class="absolute invisible block pt-8 -mt-8"></span><a href="#làm-gì-có-việc-nào-dễ-dàng-bao-giờ">Làm gì có việc nào dễ dàng bao giờ?</a><svg width="16" height="24" stroke-width="1.5"><use xlink:href="/assets/icons.svg#link"></use></svg></h2><p>Viết chơi chơi, chạy rồi mừng hết sức, nhưng cảm giác không an tâm vẫn lượn lờ đâu đó quanh đây.</p><p>Yé, vừa có cảm giác liền bắt ngay cú lỗi đến từ một câu chuyện như sau: Trước đó mình có cho một biến <code>registered</code> chứa các lớp đã được đăng ký thành công để sau khi ajax hoàn thành thì tiến hành xóa những lớp đó khỏi danh sách ban đầu. Nhưng không hiểu sao khi chạy lại vòng lặp thì nó vẫn còn những lớp đã đăng ký ở đó.</p><p>Sau một hồi ngồi vật vờ lẩn quẩn với mấy cái vòng for, điều kiện if, mình mới để ý tới việc bất <strong>đồng bộ (<em>sync</em>)</strong> của ajax. Nếu bạn có nghiên cứu sâu về ajax, sẽ biết một thứ gọi là <strong>async</strong> (bất đồng bộ). Biến <code>registered</code> được gán bên trong ajax thì ra bên ngoài không có các giá trị được gán vào, bởi vì khi ajax chưa chạy tới đó thì biến <code>registered</code> đã được chạy rồi.</p><p>Tuy nhiên nếu chạy ajax với async mặc định là true thì chúng ta sẽ ăn một cú <strong>undefined</strong> đến từ việc bất đồng bộ biến bên trong và bên ngoài ajax. Thế nên ta phải set lại giá trị <code>async: false</code> thì mới đổ được data vào trong các biến bên ngoài ajax.</p><p>Hiểu nguyên nhân, thì giải quyết thôi nào, ez ez:</p><pre><div class="mb-10 mt-4 pb-4 overflow-x-auto border border-mid-gray rounded-sm pt-4"><code class="block float-left min-w-full px-4"><span style="color:#000000">$.</span><span style="color:#6F42C1">ajaxSetup</span><span style="color:#000000">({</span>
<span style="color:#000000">    async</span><span style="color:#D73A49">:</span><span style="color:#000000"> </span><span style="color:#005CC5">false</span>
<span style="color:#000000">});</span>
</code></div></pre><p>Bạn tưởng hết lỗi rồi phải không? <strong>Nồ.</strong> Đời làm gì có cái gì như mơ, tránh vỏ dưa thì gặp vỏ dừa thôi. Thứ mà mình quên mất lần này là việc *session login <strong>hết hạn*</strong>. Ở UIT bất cứ trang nào cũng có login session không vĩnh cửu, sau một khoảng thời gian đăng nhập sẽ bị logout. Mặc dù có nút ghi nhớ, nhưng không bao giờ hoạt động, chả hiểu để đó làm gì :confused:</p><p>Yah, tức là phải có thêm 1 vòng ajax post để login, sau đó login thành công thì mới tiến hành ajax get để lấy thông tin, có thông tin rồi thì mới ajax post để đăng ký.</p><strong>Duhhhhhhh!</strong><p>May mà login của ĐKHP không có Capcha. Thế nên việc ajax đăng nhập cũng khá đơn giản mà không cần dùng tới token.</p><p>Giờ thì khởi tạo một biến config người dùng</p><pre><div class="mb-10 mt-4 pb-4 overflow-x-auto border border-mid-gray rounded-sm pt-4"><code class="block float-left min-w-full px-4"><span style="color:#D73A49">var</span><span style="color:#000000"> auth </span><span style="color:#D73A49">=</span><span style="color:#000000"> {</span>
<span style="color:#000000">    name</span><span style="color:#D73A49">:</span><span style="color:#000000"> </span><span style="color:#22863A">&quot;17520750&quot;</span><span style="color:#000000">,</span>
<span style="color:#000000">    pass</span><span style="color:#D73A49">:</span><span style="color:#000000"> </span><span style="color:#22863A">&quot;bantuongdaylapasswordcuatoiu?khongphaidauu!hahaha&quot;</span>
<span style="color:#000000">};</span>
</code></div></pre><p>Sau đó viết ajax login</p><pre><div class="mb-10 mt-4 pb-4 overflow-x-auto border border-mid-gray rounded-sm pt-4"><code class="block float-left min-w-full px-4"><span style="color:#D73A49">var</span><span style="color:#000000"> login </span><span style="color:#D73A49">=</span><span style="color:#000000"> $.</span><span style="color:#6F42C1">ajax</span><span style="color:#000000">({</span>
<span style="color:#000000">    url</span><span style="color:#D73A49">:</span><span style="color:#000000"> </span><span style="color:#22863A">&quot;https://dkhp.uit.edu.vn/&quot;</span><span style="color:#000000">,</span>
<span style="color:#000000">    type</span><span style="color:#D73A49">:</span><span style="color:#000000"> </span><span style="color:#22863A">&quot;POST&quot;</span><span style="color:#000000">,</span>
<span style="color:#000000">    data</span><span style="color:#D73A49">:</span><span style="color:#000000"> {</span>
<span style="color:#000000">        name</span><span style="color:#D73A49">:</span><span style="color:#000000"> auth.</span><span style="color:#005CC5">name</span><span style="color:#000000">,</span>
<span style="color:#000000">        pass</span><span style="color:#D73A49">:</span><span style="color:#000000"> auth.pass,</span>
<span style="color:#000000">    }</span>
<span style="color:#000000">});</span>
<!-- -->
<span style="color:#000000">login.</span><span style="color:#6F42C1">done</span><span style="color:#000000">(</span><span style="color:#D73A49">function</span><span style="color:#000000"> (xhrLogin, status) {</span>
<span style="color:#000000">    </span><span style="color:#005CC5">console</span><span style="color:#000000">.</span><span style="color:#005CC5">log</span><span style="color:#000000">(status);</span>
<span style="color:#000000">}).</span><span style="color:#6F42C1">fail</span><span style="color:#000000">(</span><span style="color:#D73A49">function</span><span style="color:#000000"> (xhrFail, status, error) {</span>
<span style="color:#000000">    </span><span style="color:#005CC5">console</span><span style="color:#000000">.</span><span style="color:#005CC5">error</span><span style="color:#000000">(status, error);</span>
<span style="color:#000000">});</span>
</code></div></pre><p>Ờ, có vẻ ổn, cơ mà sao nó cứ chạy mãi không dừng ấy nhỉ? <strong>Lại quên.</strong> Quên mất hết lớp để đăng ký thì phải dừng</p><pre><div class="mb-10 mt-4 pb-4 overflow-x-auto border border-mid-gray rounded-sm pt-4"><code class="block float-left min-w-full px-4"><span style="color:#D73A49">if</span><span style="color:#000000"> (ClassList.</span><span style="color:#005CC5">length</span><span style="color:#000000"> </span><span style="color:#D73A49">==</span><span style="color:#000000"> </span><span style="color:#005CC5">0</span><span style="color:#000000">) {</span>
<span style="color:#000000">    </span><span style="color:#005CC5">console</span><span style="color:#000000">.</span><span style="color:#005CC5">log</span><span style="color:#000000">(</span><span style="color:#22863A">&quot;Hết lớp đăng ký rồi bạn tôi ơiiiii!&quot;</span><span style="color:#000000">);</span>
<span style="color:#000000">    </span><span style="color:#6A737D">// break;</span>
<span style="color:#000000">}</span>
</code></div></pre><p>Coi như hết lỗi rồi á, hứa.</p><h2><span id="bài-học-rút-lại" class="absolute invisible block pt-8 -mt-8"></span><a href="#bài-học-rút-lại">Bài học rút lại</a><svg width="16" height="24" stroke-width="1.5"><use xlink:href="/assets/icons.svg#link"></use></svg></h2><ul><li>Bản chất của cái tool này không có gì ghê gớm, chỉ là thay vì phải hoạt động bằng tay thì mình sử dụng code để làm việc thay cho mình.</li><li>Có tool không có nghĩa là bạn sẽ đăng ký được lớp trước, mạng của bạn yếu mà có tool thì vẫn vậy.</li><li><strong>Về việc share code thì mình xin phép không share</strong>, vì như mình đã nói, lượng request quá lớn lên server là lý do thứ nhất làm server sập. Bản thân mình hiểu mình đang làm gì nên mình mới dám làm, thời gian giữa các request mình cũng điều chỉnh có chừng mực.</li><li>Và điều cuối cùng: mình không quan tâm bất cứ dư luận nào nói về việc làm này là chơi bẩn hay cái gì, mình là dân CNTT, mình chỉ giải quyết vấn đề mình đang gặp phải bằng phương pháp CNTT, và mình hiểu mình đang làm gì.</li></ul><p>Cảm ơn các bạn đã xem bài viết, hy vọng blog này có ích cho các bạn. Σ(ノ°▽°)ノ</p><figure class="flex flex-col items-center max-w-full my-10 tablet:my-12 desktop:my-16"><img alt="Kết quả" data-src="https://i.imgur.com/ujWzizu.png" class="lazyload"/><figcaption class="px-2 mt-4 text-xs tracking-wide text-center tablet:text-sm desktop:text-base">Kết quả</figcaption></figure></div></article></div></div></main><nav class="w-full h-16 bg-white border-t border-mid-gray select-none fixed bottom-0 left-0 tablet:hidden"><div class="flex justify-between w-full max-w-sm px-2 mx-auto"><a href="/"><div class="flex flex-col items-center justify-center w-16 h-16 relative text-black"><h5 class="mt-1 text-xs font-medium tracking-wide">Home</h5></div></a><a href="/about"><div class="flex flex-col items-center justify-center w-16 h-16 relative text-black"><h5 class="mt-1 text-xs font-medium tracking-wide">About</h5></div></a><a href="https://ko-fi.com/monodyle" target="_blank"><div class="flex flex-col items-center justify-center w-16 h-16 relative text-black"><h5 class="mt-1 text-xs font-medium tracking-wide">☕ Buy me a coffee</h5></div></a></div></nav></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/toi-da-viet-dkhp-helper-nhu-the-nao","query":{},"buildId":"x9WJkXvd179KAEIzP7gse","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/chunks/polyfills-08c52e9b0920dbad6282.js"></script><script src="/_next/static/chunks/main-7268da2420ae7ee3cbc5.js" async=""></script><script src="/_next/static/chunks/webpack-488dc228921f1fdbc0e7.js" async=""></script><script src="/_next/static/chunks/framework.8e39f187f5de284a7e93.js" async=""></script><script src="/_next/static/chunks/commons.9233c5a7222f426c41fb.js" async=""></script><script src="/_next/static/chunks/pages/_app-ab6a323af59c0bc98c4c.js" async=""></script><script src="/_next/static/chunks/05d954cf.8590707d2bd7065d9eb0.js" async=""></script><script src="/_next/static/chunks/fb55e402fbac2b3f5997de739cc6df0392f34ac4.229205e32f8ecc5ab44d.js" async=""></script><script src="/_next/static/chunks/c70a8af0150c67be23b7e2c359c8a02097d385df.c76d0204478302340b0d.js" async=""></script><script src="/_next/static/chunks/pages/blog/toi-da-viet-dkhp-helper-nhu-the-nao-06241d373a45d20d092c.js" async=""></script><script src="/_next/static/x9WJkXvd179KAEIzP7gse/_buildManifest.js" async=""></script><script src="/_next/static/x9WJkXvd179KAEIzP7gse/_ssgManifest.js" async=""></script></body></html>