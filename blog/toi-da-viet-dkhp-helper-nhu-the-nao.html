<!DOCTYPE html><html lang="en"><head><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#24292e"/><meta name="apple-mobile-web-app-title" content="The Monody&#x27;s Space"/><meta name="application-name" content="The Monody&#x27;s Space"/><meta name="msapplication-TileColor" content="#1366E9"/><meta name="theme-color" content="#ffffff"/><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Tôi đã viết ĐKHP Helper như thế nào?</title><meta name="title" content="Tôi đã viết ĐKHP Helper như thế nào?"/><meta name="description" content="Hello, just a simple guy."/><meta name="image" content="https://monodyle.github.io/assets/blog/toi-da-viet-dkhp-helper-nhu-the-nao/featured.jpg"/><meta property="og:url" content="https://monodyle.github.io/blog/toi-da-viet-dkhp-helper-nhu-the-nao"/><meta property="og:type" content="website"/><meta property="og:title" content="Tôi đã viết ĐKHP Helper như thế nào?"/><meta property="og:description" content="Hello, just a simple guy."/><meta property="og:image" content="https://monodyle.github.io/assets/blog/toi-da-viet-dkhp-helper-nhu-the-nao/featured.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="Monody Le"/><meta name="twitter:title" content="Tôi đã viết ĐKHP Helper như thế nào?"/><meta name="twitter:description" content="Hello, just a simple guy."/><meta name="twitter:image" content="https://monodyle.github.io/assets/blog/toi-da-viet-dkhp-helper-nhu-the-nao/featured.jpg"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"/><meta name="next-head-count" content="17"/><link rel="preload" href="/_next/static/css/c4614ce58cf99c21c738.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c4614ce58cf99c21c738.css" data-n-g=""/><link rel="preload" href="/_next/static/css/813fee474de2c51b1345.css" as="style"/><link rel="stylesheet" href="/_next/static/css/813fee474de2c51b1345.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-cf627c1b502115102538.js" defer=""></script><script src="/_next/static/chunks/framework-64eb7138163e04c228e4.js" defer=""></script><script src="/_next/static/chunks/main-021fc08f00c92a589d4e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-73554b86524b8d57d1e7.js" defer=""></script><script src="/_next/static/chunks/670-e913ad2df44a9360cf4c.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-e2c860bc783d100747b6.js" defer=""></script><script src="/_next/static/chaac5Dk-xjaWZa4ZDpoT/_buildManifest.js" defer=""></script><script src="/_next/static/chaac5Dk-xjaWZa4ZDpoT/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="flex flex-col items-center justify-between min-h-screen"><div class="container flex flex-col px-16 py-20 mx-auto"><nav class="flex items-center justify-between leading-6"><div class="flex items-center"><a class="text-base font-bold leading-6 rainbown cursor-pointer" href="/">home.</a><div class="px-4 text-dark-muted">/</div><span class="text-base font-bold leading-6">writing.<!-- --> <!-- -->📝</span></div><div class="flex items-center"><div class="w-12"></div><a class="text-base font-bold leading-6 rainbown cursor-none" href="/hi">say hi.</a><div class="cursor_cursor__1ID5l cursor_hide__17TGI " style="left:0;top:0"><div class="cursor_icon__2mcpm"><div class="cursor_wave__1Tlmd">👋</div></div></div><div class="w-12"></div><a class="text-base font-bold leading-6 rainbown cursor-none" href="/work">working.</a><div class="cursor_cursor__1ID5l cursor_hide__17TGI " style="left:0;top:0"><div class="cursor_icon__2mcpm">💻</div></div></div></nav><div class="h-16"></div><div class="flex-auto flex-shrink-0"><article class="post_article__2w3XN"><div class="mb-6 font-bold"><a class="rainbown" href="/blog">&lt; Back</a></div><div class="post_hero__3BSnJ"><img src="/assets/blog/toi-da-viet-dkhp-helper-nhu-the-nao/featured.jpg" alt="Tôi đã viết ĐKHP Helper như thế nào?" title="Tôi đã viết ĐKHP Helper như thế nào?"/></div><div class="flex items-center justify-between mb-2"><span class="post_time__ih63X">Aug 7, 2019</span><div class="flex"><span class="post_tag__28ZFZ">dev</span><span class="post_tag__28ZFZ">web</span><span class="post_tag__28ZFZ">javascript</span></div></div><h2 class="post_title__3g4nB">Tôi đã viết ĐKHP Helper như thế nào?</h2><div id="content" class="post_content__1tL7U post_markdown__38t3u"><h2 id="ngày-xửa-ngày-xưa">Ngày xửa ngày xưa...</h2>
<p>Cứ 9h sáng, kỳ nào cũng thế, không có sự khoan nhượng nào, một trận chiến khốc liệt trên xa trường, tất cả vỏn vẹn chưa tới một giây...</p>
<p>Sau đó thì web sập. Đấy là thứ mà sinh viên <strong>UIT</strong> vẫn gọi là <strong>Đăng ký học phần</strong>. Vừa mở đăng ký, sinh viên lùa vào như siêu thị sale sản phẩm 100%, ai cũng muốn giành cho mình chỗ tốt, mọi việc cứ thế mà lộn tùng phèo hết cả lên. Ai may mắn nhanh tay thì giành trước, kẻ nào xui xẻo đến sau... coi như khó có cơ hội.</p>
<p>Mình cũng từng như thế, tranh giành khốc liệt, server phía bên trường sập vẫn cứ sập, sinh viên thấy server sập lại cứ thế mà <strong>F5</strong>, mà càng F5 thì cache càng nặng, server càng nhiều request, thế lại càng sập, mà càng sập lại càng khó để đăng ký. Haizz, trước tình cảnh năm nhất và kỳ I năm 2 không thể đăng ký được những gì mình mong muốn. Ấm ức mãi cũng chả giải quyết gì, nhìn nhiều đứa chửi đổng cũng thở dài, cũng nghe nhạc Mr.Siro nhìn ra cửa sổ trầm tư về cuộc sống thường nhật. Bên cạnh vẫn là chiếc laptop hiển thị lỗi, cảm giác cuộc sống đôi khi vô vị.</p>
<p>Xem cái meme nghỉ mắt tý</p>
<p></p>
<p>Tự dưng lúc đó chẹp lưỡi, bảo giá như có thằng nào canh hộ mình, đỡ mất công ngồi đây canh.... Thế mà quên mất mình là dân CNTT, tại sao không giải quyết bằng phương pháp Công nghệ Thông tin? Thế là lại lọ mọ ngồi code, cứ thế mà quên mất đang phải ĐKHP, cứ thế mà ĐKHP Helper đã ra đời.</p>
<h2 id="từ-ý-tưởng-tới-thực-tế">Từ ý tưởng tới thực tế</h2>
<p>Phác thảo ý tưởng: Ý tưởng ban đầu là spam request <strong>liên tục</strong> lên server để giành slot trước, tuy nhiên việc spam một số lượng request lớn sẽ làm server nặng thêm, chưa kể nếu server <strong>limit request</strong> thì mình chết chắc. Thế nên phải giãn khoảng cách các request ra. Trước hết là phải viết get request lấy thông tin form để thực hiện post request tiếp theo. Sau đó post request theo token và các thông tin cần thiết trong form kèm danh sách lớp mong muốn lên server, rồi nhận response để kiểm tra việc đăng ký đã hoàn thành hay chưa? Nếu đã đăng ký thành công thì log ra 1 thông báo, cùng việc xóa môn học đó ra khỏi danh sách cần đăng ký, thực hiện lại vòng lặp với các môn học chưa được hoàn thành.</p>
<p>Nói sơ sơ thì chắc mọi người cũng hiểu về bản chất của tool này: Thay thế tay người làm một loạt các hành động thay vì phải ngồi trực và click bằng tay, chứ không phải khai thác lỗi dữ liệu để chiếm slot. Việc một thao tác bằng tay sẽ tốn nhiều thời gian hơn gấp trăm/ngàn lần so với việc để máy thực hiện thao tác giúp chúng ta.</p>
<p></p>
<p>Bắt tay viết code nào.</p>
<p>Đầu tiên là một get request để lấy thông form đăng ký học phần, ở đây mình sẽ sử dụng <strong>ajax</strong> để request lên trang đkhp</p>
<pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #D73A49">var</span><span style="color: #24292E"> request </span><span style="color: #D73A49">=</span><span style="color: #24292E"> $.</span><span style="color: #6F42C1">ajax</span><span style="color: #24292E">({</span></span>
<span class="line"><span style="color: #24292E">    url: </span><span style="color: #032F62">"https://dkhp.uit.edu.vn/sinhvien/hocphan/dangky"</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">    type: </span><span style="color: #032F62">"get"</span></span>
<span class="line"><span style="color: #24292E">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">var</span><span style="color: #24292E"> formData </span><span style="color: #D73A49">=</span><span style="color: #24292E"> request.</span><span style="color: #6F42C1">done</span><span style="color: #24292E">(</span><span style="color: #D73A49">function</span><span style="color: #24292E">(</span><span style="color: #E36209">response</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">    console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(response);</span></span>
<span class="line"><span style="color: #24292E">});</span></span>
<span class="line"></span></code></pre>
<p>Nếu các bạn đã dùng ajax, hẳn sẽ biết việc <strong>request</strong> của ajax bản chất vẫn là load cả một website ra, vì thế nên response của chúng ta là một file text bao gồm html của một trang web, khá giống vơi việc bạn vào trang <a href="https://dkhp.uit.edu.vn/sinhvien/hocphan/dangky">đăng ký</a> rồi <strong>Ctrl + U</strong> để lấy source trang web. Thế nên thời gian request của ajax và thời gian dùng browser request là tương đương, tốc độ hơn ở đây là xử lý thông tin và không tốn thời gian browser <strong>render DOM</strong> ra màn hình người dùng.</p>
<p>Tuy nhiên vì vẫn sẽ có những lúc server sập, thế nên chúng ta phải phòng hờ trường hợp này bằng cách bắt lỗi từ ajax</p>
<p></p>
<pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #24292E">request.</span><span style="color: #6F42C1">fail</span><span style="color: #24292E">(</span><span style="color: #D73A49">function</span><span style="color: #24292E"> (</span><span style="color: #E36209">xhr</span><span style="color: #24292E">, </span><span style="color: #E36209">status</span><span style="color: #24292E">, </span><span style="color: #E36209">errorThrown</span><span style="color: #24292E">){</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D">// Log the error to the console</span></span>
<span class="line"><span style="color: #24292E">    console.</span><span style="color: #6F42C1">error</span><span style="color: #24292E">(</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #032F62">"The following error occurred: "</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> status, errorThrown</span></span>
<span class="line"><span style="color: #24292E">    );</span></span>
<span class="line"><span style="color: #24292E">});</span></span>
<span class="line"></span></code></pre>
<p>Bước thứ 2, lấy thông tin trong form. Việc các bạn gửi thông tin trong bất kỳ form nào: Đăng nhập, đăng ký, post bài lên facebook, tạo group mới, gửi email, hầu như đều cần một vài thứ thông tin, quan trọng nhất là <strong>token</strong> đối với những form yêu cầu tính bảo mật cao và cũng là thứ để chống spam, chúng thường được lưu trong các hidden input nên ở giao diện sẽ không được hiển thị, nhưng toàn bộ các input có name trong form đều sẽ được gửi như một thông tin kèm theo lên server. Thế nên không thể thiếu những thông tin này.</p>
<p></p>
<p>Thông tin tiếp theo chúng ta cần là những môn học cần đăng ký.</p>
<pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #D73A49">var</span><span style="color: #24292E"> ClassList </span><span style="color: #D73A49">=</span><span style="color: #24292E"> [</span><span style="color: #032F62">'IS401.K11'</span><span style="color: #24292E">, </span><span style="color: #032F62">'IS402.K11'</span><span style="color: #24292E">, </span><span style="color: #032F62">'IS405.K11'</span><span style="color: #24292E">, </span><span style="color: #032F62">'IS405.K11.1'</span><span style="color: #24292E">];</span></span>
<span class="line"></span></code></pre>
<p>Phương thức đăng ký, trong trang ĐKHP của UIT có 2 kiểu đăng ký:</p>
<p>1 là check vào checkbox ở những môn mình muốn học rồi đăng ký.</p>
<p></p>
<p>2 là sử dụng mã môn học, lập 1 danh sách rồi bỏ vào textarea ở khung đăng ký nhanh rồi đăng ký:</p>
<p></p>
<p>Chúng ta phải chọn 1 trong 2 cách để gửi dữ liệu, gửi cả 2 cũng được, nhưng chả ai gửi cả 2 làm gì, lỡ server xử lý cồng kềnh hơn, đâm ra chậm hơn à?</p>
<p>Nếu sử dụng cách 1, chúng ta phải đi check từng cái input để kiếm cái nào phù hợp với danh sách của mình, sau đó lấy dữ liệu từ đó mà post request.</p>
<p></p>
<p>Thử inspect xem thử, có vẻ chúng ta sẽ có một name để dùng làm thông tin đăng ký.</p>
<p></p>
<p>Nhưng mà parse HTML ra sương sương cũng thấy gần 10.000 line, thế nên việc dò thế này khá tốn kém.</p>
<p>Đối với cách 2 chỉ cần 1 cái textarea, mà mình đa đề cập bất kỳ một cái input nào trong form cũng sẽ có name riêng của nó, việc nhập liệu cũng khá dễ, thế nên mình prefer cách thứ 2 hơn.</p>
<p></p>
<p>Việc cần làm còn lại là post tất cả thông tin chúng ta có lên server đkhp để nhận response.</p>
<pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #D73A49">var</span><span style="color: #24292E"> post </span><span style="color: #D73A49">=</span><span style="color: #24292E"> $.</span><span style="color: #6F42C1">ajax</span><span style="color: #24292E">({</span></span>
<span class="line"><span style="color: #24292E">    url: </span><span style="color: #032F62">"https://dkhp.uit.edu.vn/sinhvien/hocphan/dangky"</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">    type: </span><span style="color: #032F62">"POST"</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">    data: {</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6A737D">/*</span></span>
<span class="line"><span style="color: #6A737D">            txtmasv: auth.name,</span></span>
<span class="line"><span style="color: #6A737D">            form_build_id: form_build_id,</span></span>
<span class="line"><span style="color: #6A737D">            form_token: form_token,</span></span>
<span class="line"><span style="color: #6A737D">            form_id: 'uit_dkhp_dangky_form',</span></span>
<span class="line"><span style="color: #6A737D">            ...</span></span>
<span class="line"><span style="color: #6A737D">         */</span></span>
<span class="line"><span style="color: #24292E">        </span><span style="color: #6A737D">// everything you got here</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D73A49">var</span><span style="color: #24292E"> response </span><span style="color: #D73A49">=</span><span style="color: #24292E"> post.</span><span style="color: #6F42C1">done</span><span style="color: #24292E">(</span><span style="color: #D73A49">function</span><span style="color: #24292E">(</span><span style="color: #E36209">xhr</span><span style="color: #24292E">, </span><span style="color: #E36209">status</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">    console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(status);</span></span>
<span class="line"><span style="color: #24292E">}).</span><span style="color: #6F42C1">fail</span><span style="color: #24292E">(</span><span style="color: #D73A49">function</span><span style="color: #24292E"> (</span><span style="color: #E36209">xhr</span><span style="color: #24292E">, </span><span style="color: #E36209">status</span><span style="color: #24292E">, </span><span style="color: #E36209">error</span><span style="color: #24292E">) { </span><span style="color: #6A737D">// dont forget the error</span></span>
<span class="line"><span style="color: #24292E">    console.</span><span style="color: #6F42C1">error</span><span style="color: #24292E">(status, error);</span></span>
<span class="line"><span style="color: #24292E">});</span></span>
<span class="line"></span></code></pre>
<p>Thử nghiệm nay nàoooo</p>
<p></p>
<p>Có vẻ khá ổn, bây giờ thì chúng ta phải kiểm tra danh sách các môn học đã được đăng ký thành công, và loại bỏ chúng ra khỏi danh sách request.</p>
<p>Chúng ta có response trả về từ post request, có một mớ đống hổ lốn đó thì việc check khá dễ dàng, thử inspect các lớp đã đăng ký ta sẽ thấy input name khác với những lớp còn lại:</p>
<p></p>
<p>Việc cần làm là check làm sao? Lúc này phải dùng <strong>RegEx</strong> thần thánh rồi :evil_laugh:</p>
<pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #D73A49">new</span><span style="color: #24292E"> </span><span style="color: #005CC5">RegExp</span><span style="color: #24292E">(</span><span style="color: #032F62">"table_lophoc_dadk</span><span style="color: #005CC5">\\</span><span style="color: #032F62">["</span><span style="color: #24292E"> </span><span style="color: #D73A49">+</span><span style="color: #24292E"> subject_id.</span><span style="color: #6F42C1">replace</span><span style="color: #24292E">(</span><span style="color: #032F62">"."</span><span style="color: #24292E">, </span><span style="color: #032F62">"</span><span style="color: #005CC5">\\</span><span style="color: #032F62">."</span><span style="color: #24292E">) </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #032F62">"</span><span style="color: #005CC5">\\</span><span style="color: #032F62">]"</span><span style="color: #24292E">);</span></span>
<span class="line"></span></code></pre>
<p>Check xong lưu array vào một variable tạm gọi là <code>registered</code>, sau đó lần lượt vứt chúng ra khỏi danh sách lớp ban đầu</p>
<pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #D73A49">for</span><span style="color: #24292E"> (</span><span style="color: #D73A49">var</span><span style="color: #24292E"> subject </span><span style="color: #D73A49">in</span><span style="color: #24292E"> registered) {</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (ClassList.</span><span style="color: #6F42C1">includes</span><span style="color: #24292E">(subject)) ClassList.</span><span style="color: #6F42C1">splice</span><span style="color: #24292E">(ClassList.</span><span style="color: #6F42C1">indexOf</span><span style="color: #24292E">(subject), </span><span style="color: #005CC5">1</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span></code></pre>
<p>Yé, coi như xong ĐKHP Helper rồi đó.</p>
<p><em>Nhưng...</em></p>
<h2 id="làm-gì-có-việc-nào-dễ-dàng-bao-giờ">Làm gì có việc nào dễ dàng bao giờ?</h2>
<p>Viết chơi chơi, chạy rồi mừng hết sức, nhưng cảm giác không an tâm vẫn lượn lờ đâu đó quanh đây.</p>
<p>Yé, vừa có cảm giác liền bắt ngay cú lỗi đến từ một câu chuyện như sau: Trước đó mình có cho một biến <code>registered</code> chứa các lớp đã được đăng ký thành công để sau khi ajax hoàn thành thì tiến hành xóa những lớp đó khỏi danh sách ban đầu. Nhưng không hiểu sao khi chạy lại vòng lặp thì nó vẫn còn những lớp đã đăng ký ở đó.</p>
<p>Sau một hồi ngồi vật vờ lẩn quẩn với mấy cái vòng for, điều kiện if, mình mới để ý tới việc bất <strong>đồng bộ (<em>sync</em>)</strong> của ajax. Nếu bạn có nghiên cứu sâu về ajax, sẽ biết một thứ gọi là <strong>async</strong> (bất đồng bộ). Biến <code>registered</code> được gán bên trong ajax thì ra bên ngoài không có các giá trị được gán vào, bởi vì khi ajax chưa chạy tới đó thì biến <code>registered</code> đã được chạy rồi.</p>
<p>Tuy nhiên nếu chạy ajax với async mặc định là true thì chúng ta sẽ ăn một cú <strong>undefined</strong> đến từ việc bất đồng bộ biến bên trong và bên ngoài ajax. Thế nên ta phải set lại giá trị <code>async: false</code> thì mới đổ được data vào trong các biến bên ngoài ajax.</p>
<p>Hiểu nguyên nhân, thì giải quyết thôi nào, ez ez:</p>
<pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #24292E">$.</span><span style="color: #6F42C1">ajaxSetup</span><span style="color: #24292E">({</span></span>
<span class="line"><span style="color: #24292E">    async: </span><span style="color: #005CC5">false</span></span>
<span class="line"><span style="color: #24292E">});</span></span>
<span class="line"></span></code></pre>
<p>Bạn tưởng hết lỗi rồi phải không? <strong>Nồ.</strong> Đời làm gì có cái gì như mơ, tránh vỏ dưa thì gặp vỏ dừa thôi. Thứ mà mình quên mất lần này là việc <em>session login <strong>hết hạn</strong></em>. Ở UIT bất cứ trang nào cũng có login session không vĩnh cửu, sau một khoảng thời gian đăng nhập sẽ bị logout. Mặc dù có nút ghi nhớ, nhưng không bao giờ hoạt động, chả hiểu để đó làm gì :confused:</p>
<p>Yah, tức là phải có thêm 1 vòng ajax post để login, sau đó login thành công thì mới tiến hành ajax get để lấy thông tin, có thông tin rồi thì mới ajax post để đăng ký.</p>
<p><strong>Duhhhhhhh!</strong></p>
<p>May mà login của ĐKHP không có Capcha. Thế nên việc ajax đăng nhập cũng khá đơn giản mà không cần dùng tới token.</p>
<p>Giờ thì khởi tạo một biến config người dùng</p>
<pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #D73A49">var</span><span style="color: #24292E"> auth </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></span>
<span class="line"><span style="color: #24292E">    name: </span><span style="color: #032F62">"17520750"</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">    pass: </span><span style="color: #032F62">"bantuongdaylapasswordcuatoiu?khongphaidauu!hahaha"</span></span>
<span class="line"><span style="color: #24292E">};</span></span>
<span class="line"></span></code></pre>
<p>Sau đó viết ajax login</p>
<pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #D73A49">var</span><span style="color: #24292E"> login </span><span style="color: #D73A49">=</span><span style="color: #24292E"> $.</span><span style="color: #6F42C1">ajax</span><span style="color: #24292E">({</span></span>
<span class="line"><span style="color: #24292E">    url: </span><span style="color: #032F62">"https://dkhp.uit.edu.vn/"</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">    type: </span><span style="color: #032F62">"POST"</span><span style="color: #24292E">,</span></span>
<span class="line"><span style="color: #24292E">    data: {</span></span>
<span class="line"><span style="color: #24292E">        name: auth.name,</span></span>
<span class="line"><span style="color: #24292E">        pass: auth.pass,</span></span>
<span class="line"><span style="color: #24292E">    }</span></span>
<span class="line"><span style="color: #24292E">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #24292E">login.</span><span style="color: #6F42C1">done</span><span style="color: #24292E">(</span><span style="color: #D73A49">function</span><span style="color: #24292E"> (</span><span style="color: #E36209">xhrLogin</span><span style="color: #24292E">, </span><span style="color: #E36209">status</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">    console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(status);</span></span>
<span class="line"><span style="color: #24292E">}).</span><span style="color: #6F42C1">fail</span><span style="color: #24292E">(</span><span style="color: #D73A49">function</span><span style="color: #24292E"> (</span><span style="color: #E36209">xhrFail</span><span style="color: #24292E">, </span><span style="color: #E36209">status</span><span style="color: #24292E">, </span><span style="color: #E36209">error</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">    console.</span><span style="color: #6F42C1">error</span><span style="color: #24292E">(status, error);</span></span>
<span class="line"><span style="color: #24292E">});</span></span>
<span class="line"></span></code></pre>
<p>Ờ, có vẻ ổn, cơ mà sao nó cứ chạy mãi không dừng ấy nhỉ? <strong>Lại quên.</strong> Quên mất hết lớp để đăng ký thì phải dừng</p>
<pre class="shiki" style="background-color: #fff"><code><span class="line"><span style="color: #D73A49">if</span><span style="color: #24292E"> (ClassList.</span><span style="color: #005CC5">length</span><span style="color: #24292E"> </span><span style="color: #D73A49">==</span><span style="color: #24292E"> </span><span style="color: #005CC5">0</span><span style="color: #24292E">) {</span></span>
<span class="line"><span style="color: #24292E">    console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">"Hết lớp đăng ký rồi bạn tôi ơiiiii!"</span><span style="color: #24292E">);</span></span>
<span class="line"><span style="color: #24292E">    </span><span style="color: #6A737D">// break;</span></span>
<span class="line"><span style="color: #24292E">}</span></span>
<span class="line"></span></code></pre>
<p>Coi như hết lỗi rồi á, hứa.</p>
<h2 id="bài-học-rút-lại">Bài học rút lại</h2>
<ul>
<li>Bản chất của cái tool này không có gì ghê gớm, chỉ là thay vì phải hoạt động bằng tay thì mình sử dụng code để làm việc thay cho mình.</li>
<li>Có tool không có nghĩa là bạn sẽ đăng ký được lớp trước, mạng của bạn yếu mà có tool thì vẫn vậy.</li>
<li><strong>Về việc share code thì mình xin phép không share</strong>, vì như mình đã nói, lượng request quá lớn lên server là lý do thứ nhất làm server sập. Bản thân mình hiểu mình đang làm gì nên mình mới dám làm, thời gian giữa các request mình cũng điều chỉnh có chừng mực.</li>
<li>Và điều cuối cùng: mình không quan tâm bất cứ dư luận nào nói về việc làm này là chơi bẩn hay cái gì, mình là dân CNTT, mình chỉ giải quyết vấn đề mình đang gặp phải bằng phương pháp CNTT, và mình hiểu mình đang làm gì.</li>
</ul>
<p>Cảm ơn các bạn đã xem bài viết, hy vọng blog này có ích cho các bạn. Σ(ノ°▽°)ノ</p>
<p></p></div></article></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Tôi đã viết ĐKHP Helper như thế nào?","date":"Aug 07, 2019","slug":"toi-da-viet-dkhp-helper-nhu-the-nao","content":"\u003ch2 id=\"ngày-xửa-ngày-xưa\"\u003eNgày xửa ngày xưa...\u003c/h2\u003e\n\u003cp\u003eCứ 9h sáng, kỳ nào cũng thế, không có sự khoan nhượng nào, một trận chiến khốc liệt trên xa trường, tất cả vỏn vẹn chưa tới một giây...\u003c/p\u003e\n\u003cp\u003eSau đó thì web sập. Đấy là thứ mà sinh viên \u003cstrong\u003eUIT\u003c/strong\u003e vẫn gọi là \u003cstrong\u003eĐăng ký học phần\u003c/strong\u003e. Vừa mở đăng ký, sinh viên lùa vào như siêu thị sale sản phẩm 100%, ai cũng muốn giành cho mình chỗ tốt, mọi việc cứ thế mà lộn tùng phèo hết cả lên. Ai may mắn nhanh tay thì giành trước, kẻ nào xui xẻo đến sau... coi như khó có cơ hội.\u003c/p\u003e\n\u003cp\u003eMình cũng từng như thế, tranh giành khốc liệt, server phía bên trường sập vẫn cứ sập, sinh viên thấy server sập lại cứ thế mà \u003cstrong\u003eF5\u003c/strong\u003e, mà càng F5 thì cache càng nặng, server càng nhiều request, thế lại càng sập, mà càng sập lại càng khó để đăng ký. Haizz, trước tình cảnh năm nhất và kỳ I năm 2 không thể đăng ký được những gì mình mong muốn. Ấm ức mãi cũng chả giải quyết gì, nhìn nhiều đứa chửi đổng cũng thở dài, cũng nghe nhạc Mr.Siro nhìn ra cửa sổ trầm tư về cuộc sống thường nhật. Bên cạnh vẫn là chiếc laptop hiển thị lỗi, cảm giác cuộc sống đôi khi vô vị.\u003c/p\u003e\n\u003cp\u003eXem cái meme nghỉ mắt tý\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eTự dưng lúc đó chẹp lưỡi, bảo giá như có thằng nào canh hộ mình, đỡ mất công ngồi đây canh.... Thế mà quên mất mình là dân CNTT, tại sao không giải quyết bằng phương pháp Công nghệ Thông tin? Thế là lại lọ mọ ngồi code, cứ thế mà quên mất đang phải ĐKHP, cứ thế mà ĐKHP Helper đã ra đời.\u003c/p\u003e\n\u003ch2 id=\"từ-ý-tưởng-tới-thực-tế\"\u003eTừ ý tưởng tới thực tế\u003c/h2\u003e\n\u003cp\u003ePhác thảo ý tưởng: Ý tưởng ban đầu là spam request \u003cstrong\u003eliên tục\u003c/strong\u003e lên server để giành slot trước, tuy nhiên việc spam một số lượng request lớn sẽ làm server nặng thêm, chưa kể nếu server \u003cstrong\u003elimit request\u003c/strong\u003e thì mình chết chắc. Thế nên phải giãn khoảng cách các request ra. Trước hết là phải viết get request lấy thông tin form để thực hiện post request tiếp theo. Sau đó post request theo token và các thông tin cần thiết trong form kèm danh sách lớp mong muốn lên server, rồi nhận response để kiểm tra việc đăng ký đã hoàn thành hay chưa? Nếu đã đăng ký thành công thì log ra 1 thông báo, cùng việc xóa môn học đó ra khỏi danh sách cần đăng ký, thực hiện lại vòng lặp với các môn học chưa được hoàn thành.\u003c/p\u003e\n\u003cp\u003eNói sơ sơ thì chắc mọi người cũng hiểu về bản chất của tool này: Thay thế tay người làm một loạt các hành động thay vì phải ngồi trực và click bằng tay, chứ không phải khai thác lỗi dữ liệu để chiếm slot. Việc một thao tác bằng tay sẽ tốn nhiều thời gian hơn gấp trăm/ngàn lần so với việc để máy thực hiện thao tác giúp chúng ta.\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eBắt tay viết code nào.\u003c/p\u003e\n\u003cp\u003eĐầu tiên là một get request để lấy thông form đăng ký học phần, ở đây mình sẽ sử dụng \u003cstrong\u003eajax\u003c/strong\u003e để request lên trang đkhp\u003c/p\u003e\n\u003cpre class=\"shiki\" style=\"background-color: #fff\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003evar\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e request \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e $.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eajax\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e({\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    url: \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"https://dkhp.uit.edu.vn/sinhvien/hocphan/dangky\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    type: \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"get\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003evar\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e formData \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e request.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003edone\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003eresponse\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    console.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003elog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(response);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNếu các bạn đã dùng ajax, hẳn sẽ biết việc \u003cstrong\u003erequest\u003c/strong\u003e của ajax bản chất vẫn là load cả một website ra, vì thế nên response của chúng ta là một file text bao gồm html của một trang web, khá giống vơi việc bạn vào trang \u003ca href=\"https://dkhp.uit.edu.vn/sinhvien/hocphan/dangky\"\u003eđăng ký\u003c/a\u003e rồi \u003cstrong\u003eCtrl + U\u003c/strong\u003e để lấy source trang web. Thế nên thời gian request của ajax và thời gian dùng browser request là tương đương, tốc độ hơn ở đây là xử lý thông tin và không tốn thời gian browser \u003cstrong\u003erender DOM\u003c/strong\u003e ra màn hình người dùng.\u003c/p\u003e\n\u003cp\u003eTuy nhiên vì vẫn sẽ có những lúc server sập, thế nên chúng ta phải phòng hờ trường hợp này bằng cách bắt lỗi từ ajax\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cpre class=\"shiki\" style=\"background-color: #fff\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003erequest.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003efail\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e (\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003exhr\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003estatus\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003eerrorThrown\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e){\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e// Log the error to the console\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    console.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eerror\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"The following error occurred: \"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e+\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e status, errorThrown\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    );\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBước thứ 2, lấy thông tin trong form. Việc các bạn gửi thông tin trong bất kỳ form nào: Đăng nhập, đăng ký, post bài lên facebook, tạo group mới, gửi email, hầu như đều cần một vài thứ thông tin, quan trọng nhất là \u003cstrong\u003etoken\u003c/strong\u003e đối với những form yêu cầu tính bảo mật cao và cũng là thứ để chống spam, chúng thường được lưu trong các hidden input nên ở giao diện sẽ không được hiển thị, nhưng toàn bộ các input có name trong form đều sẽ được gửi như một thông tin kèm theo lên server. Thế nên không thể thiếu những thông tin này.\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eThông tin tiếp theo chúng ta cần là những môn học cần đăng ký.\u003c/p\u003e\n\u003cpre class=\"shiki\" style=\"background-color: #fff\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003evar\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e ClassList \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e [\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e'IS401.K11'\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e'IS402.K11'\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e'IS405.K11'\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e'IS405.K11.1'\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e];\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ePhương thức đăng ký, trong trang ĐKHP của UIT có 2 kiểu đăng ký:\u003c/p\u003e\n\u003cp\u003e1 là check vào checkbox ở những môn mình muốn học rồi đăng ký.\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cp\u003e2 là sử dụng mã môn học, lập 1 danh sách rồi bỏ vào textarea ở khung đăng ký nhanh rồi đăng ký:\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eChúng ta phải chọn 1 trong 2 cách để gửi dữ liệu, gửi cả 2 cũng được, nhưng chả ai gửi cả 2 làm gì, lỡ server xử lý cồng kềnh hơn, đâm ra chậm hơn à?\u003c/p\u003e\n\u003cp\u003eNếu sử dụng cách 1, chúng ta phải đi check từng cái input để kiếm cái nào phù hợp với danh sách của mình, sau đó lấy dữ liệu từ đó mà post request.\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eThử inspect xem thử, có vẻ chúng ta sẽ có một name để dùng làm thông tin đăng ký.\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eNhưng mà parse HTML ra sương sương cũng thấy gần 10.000 line, thế nên việc dò thế này khá tốn kém.\u003c/p\u003e\n\u003cp\u003eĐối với cách 2 chỉ cần 1 cái textarea, mà mình đa đề cập bất kỳ một cái input nào trong form cũng sẽ có name riêng của nó, việc nhập liệu cũng khá dễ, thế nên mình prefer cách thứ 2 hơn.\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eViệc cần làm còn lại là post tất cả thông tin chúng ta có lên server đkhp để nhận response.\u003c/p\u003e\n\u003cpre class=\"shiki\" style=\"background-color: #fff\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003evar\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e post \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e $.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eajax\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e({\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    url: \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"https://dkhp.uit.edu.vn/sinhvien/hocphan/dangky\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    type: \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"POST\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    data: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e/*\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e            txtmasv: auth.name,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e            form_build_id: form_build_id,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e            form_token: form_token,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e            form_id: 'uit_dkhp_dangky_form',\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e            ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #6A737D\"\u003e         */\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e// everything you got here\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003evar\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e response \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e post.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003edone\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003exhr\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003estatus\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    console.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003elog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(status);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e}).\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003efail\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e (\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003exhr\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003estatus\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003eerror\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e) { \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e// dont forget the error\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    console.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eerror\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(status, error);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThử nghiệm nay nàoooo\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eCó vẻ khá ổn, bây giờ thì chúng ta phải kiểm tra danh sách các môn học đã được đăng ký thành công, và loại bỏ chúng ra khỏi danh sách request.\u003c/p\u003e\n\u003cp\u003eChúng ta có response trả về từ post request, có một mớ đống hổ lốn đó thì việc check khá dễ dàng, thử inspect các lớp đã đăng ký ta sẽ thấy input name khác với những lớp còn lại:\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e\n\u003cp\u003eViệc cần làm là check làm sao? Lúc này phải dùng \u003cstrong\u003eRegEx\u003c/strong\u003e thần thánh rồi :evil_laugh:\u003c/p\u003e\n\u003cpre class=\"shiki\" style=\"background-color: #fff\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003enew\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003eRegExp\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"table_lophoc_dadk\u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e[\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e+\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e subject_id.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003ereplace\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\".\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e.\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e) \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e+\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"\u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e\\\\\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e]\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCheck xong lưu array vào một variable tạm gọi là \u003ccode\u003eregistered\u003c/code\u003e, sau đó lần lượt vứt chúng ra khỏi danh sách lớp ban đầu\u003c/p\u003e\n\u003cpre class=\"shiki\" style=\"background-color: #fff\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003efor\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e (\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003evar\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e subject \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003ein\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e registered) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e (ClassList.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eincludes\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(subject)) ClassList.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003esplice\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(ClassList.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eindexOf\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(subject), \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e1\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eYé, coi như xong ĐKHP Helper rồi đó.\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eNhưng...\u003c/em\u003e\u003c/p\u003e\n\u003ch2 id=\"làm-gì-có-việc-nào-dễ-dàng-bao-giờ\"\u003eLàm gì có việc nào dễ dàng bao giờ?\u003c/h2\u003e\n\u003cp\u003eViết chơi chơi, chạy rồi mừng hết sức, nhưng cảm giác không an tâm vẫn lượn lờ đâu đó quanh đây.\u003c/p\u003e\n\u003cp\u003eYé, vừa có cảm giác liền bắt ngay cú lỗi đến từ một câu chuyện như sau: Trước đó mình có cho một biến \u003ccode\u003eregistered\u003c/code\u003e chứa các lớp đã được đăng ký thành công để sau khi ajax hoàn thành thì tiến hành xóa những lớp đó khỏi danh sách ban đầu. Nhưng không hiểu sao khi chạy lại vòng lặp thì nó vẫn còn những lớp đã đăng ký ở đó.\u003c/p\u003e\n\u003cp\u003eSau một hồi ngồi vật vờ lẩn quẩn với mấy cái vòng for, điều kiện if, mình mới để ý tới việc bất \u003cstrong\u003eđồng bộ (\u003cem\u003esync\u003c/em\u003e)\u003c/strong\u003e của ajax. Nếu bạn có nghiên cứu sâu về ajax, sẽ biết một thứ gọi là \u003cstrong\u003easync\u003c/strong\u003e (bất đồng bộ). Biến \u003ccode\u003eregistered\u003c/code\u003e được gán bên trong ajax thì ra bên ngoài không có các giá trị được gán vào, bởi vì khi ajax chưa chạy tới đó thì biến \u003ccode\u003eregistered\u003c/code\u003e đã được chạy rồi.\u003c/p\u003e\n\u003cp\u003eTuy nhiên nếu chạy ajax với async mặc định là true thì chúng ta sẽ ăn một cú \u003cstrong\u003eundefined\u003c/strong\u003e đến từ việc bất đồng bộ biến bên trong và bên ngoài ajax. Thế nên ta phải set lại giá trị \u003ccode\u003easync: false\u003c/code\u003e thì mới đổ được data vào trong các biến bên ngoài ajax.\u003c/p\u003e\n\u003cp\u003eHiểu nguyên nhân, thì giải quyết thôi nào, ez ez:\u003c/p\u003e\n\u003cpre class=\"shiki\" style=\"background-color: #fff\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e$.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eajaxSetup\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e({\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    async: \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003efalse\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eBạn tưởng hết lỗi rồi phải không? \u003cstrong\u003eNồ.\u003c/strong\u003e Đời làm gì có cái gì như mơ, tránh vỏ dưa thì gặp vỏ dừa thôi. Thứ mà mình quên mất lần này là việc \u003cem\u003esession login \u003cstrong\u003ehết hạn\u003c/strong\u003e\u003c/em\u003e. Ở UIT bất cứ trang nào cũng có login session không vĩnh cửu, sau một khoảng thời gian đăng nhập sẽ bị logout. Mặc dù có nút ghi nhớ, nhưng không bao giờ hoạt động, chả hiểu để đó làm gì :confused:\u003c/p\u003e\n\u003cp\u003eYah, tức là phải có thêm 1 vòng ajax post để login, sau đó login thành công thì mới tiến hành ajax get để lấy thông tin, có thông tin rồi thì mới ajax post để đăng ký.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eDuhhhhhhh!\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eMay mà login của ĐKHP không có Capcha. Thế nên việc ajax đăng nhập cũng khá đơn giản mà không cần dùng tới token.\u003c/p\u003e\n\u003cp\u003eGiờ thì khởi tạo một biến config người dùng\u003c/p\u003e\n\u003cpre class=\"shiki\" style=\"background-color: #fff\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003evar\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e auth \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    name: \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"17520750\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    pass: \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"bantuongdaylapasswordcuatoiu?khongphaidauu!hahaha\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSau đó viết ajax login\u003c/p\u003e\n\u003cpre class=\"shiki\" style=\"background-color: #fff\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003evar\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e login \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e=\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e $.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eajax\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e({\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    url: \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"https://dkhp.uit.edu.vn/\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    type: \u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"POST\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    data: {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        name: auth.name,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e        pass: auth.pass,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003elogin.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003edone\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e (\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003exhrLogin\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003estatus\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    console.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003elog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(status);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e}).\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003efail\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003efunction\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e (\u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003exhrFail\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003estatus\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e, \u003c/span\u003e\u003cspan style=\"color: #E36209\"\u003eerror\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    console.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003eerror\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(status, error);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e});\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eỜ, có vẻ ổn, cơ mà sao nó cứ chạy mãi không dừng ấy nhỉ? \u003cstrong\u003eLại quên.\u003c/strong\u003e Quên mất hết lớp để đăng ký thì phải dừng\u003c/p\u003e\n\u003cpre class=\"shiki\" style=\"background-color: #fff\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #D73A49\"\u003eif\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e (ClassList.\u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003elength\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #D73A49\"\u003e==\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e \u003c/span\u003e\u003cspan style=\"color: #005CC5\"\u003e0\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    console.\u003c/span\u003e\u003cspan style=\"color: #6F42C1\"\u003elog\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e(\u003c/span\u003e\u003cspan style=\"color: #032F62\"\u003e\"Hết lớp đăng ký rồi bạn tôi ơiiiii!\"\u003c/span\u003e\u003cspan style=\"color: #24292E\"\u003e);\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e    \u003c/span\u003e\u003cspan style=\"color: #6A737D\"\u003e// break;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color: #24292E\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCoi như hết lỗi rồi á, hứa.\u003c/p\u003e\n\u003ch2 id=\"bài-học-rút-lại\"\u003eBài học rút lại\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eBản chất của cái tool này không có gì ghê gớm, chỉ là thay vì phải hoạt động bằng tay thì mình sử dụng code để làm việc thay cho mình.\u003c/li\u003e\n\u003cli\u003eCó tool không có nghĩa là bạn sẽ đăng ký được lớp trước, mạng của bạn yếu mà có tool thì vẫn vậy.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eVề việc share code thì mình xin phép không share\u003c/strong\u003e, vì như mình đã nói, lượng request quá lớn lên server là lý do thứ nhất làm server sập. Bản thân mình hiểu mình đang làm gì nên mình mới dám làm, thời gian giữa các request mình cũng điều chỉnh có chừng mực.\u003c/li\u003e\n\u003cli\u003eVà điều cuối cùng: mình không quan tâm bất cứ dư luận nào nói về việc làm này là chơi bẩn hay cái gì, mình là dân CNTT, mình chỉ giải quyết vấn đề mình đang gặp phải bằng phương pháp CNTT, và mình hiểu mình đang làm gì.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eCảm ơn các bạn đã xem bài viết, hy vọng blog này có ích cho các bạn. Σ(ノ°▽°)ノ\u003c/p\u003e\n\u003cp\u003e\u003c/p\u003e","image":"/assets/blog/toi-da-viet-dkhp-helper-nhu-the-nao/featured.jpg","tags":["dev","web","javascript"]}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"toi-da-viet-dkhp-helper-nhu-the-nao"},"buildId":"chaac5Dk-xjaWZa4ZDpoT","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>